var D=Object.defineProperty;var L=(p,e,t)=>e in p?D(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var u=(p,e,t)=>L(p,typeof e!="symbol"?e+"":e,t);import{C as M,r as T}from"./chart-DUfl3Dpl.js";import{E as S}from"./jspdf-Bsayurxw.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();class B{constructor(e=""){this.baseURL=e}async request(e,t={}){const r=`${this.baseURL}${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t};try{const s=await fetch(r,a);if(!s.ok){const i=await s.json().catch(()=>({error:"Erreur serveur"}));throw new Error(i.error||`HTTP ${s.status}`)}return await s.json()}catch(s){throw console.error(`Erreur API ${e}:`,s),s}}async getData(){return this.request("/api/data")}async saveData(e){return this.request("/api/data",{method:"POST",body:JSON.stringify(e)})}async addTransaction(e){return this.request("/api/transactions",{method:"POST",body:JSON.stringify(e)})}async updateTransaction(e,t){return this.request(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteTransaction(e){return this.request(`/api/transactions/${e}`,{method:"DELETE"})}}window.apiClient=new B;class C{constructor(){u(this,"isDark");u(this,"colorTheme");u(this,"themes",{blue:{name:"Bleu",primary:"#6366f1",primaryDark:"#4f46e5",gradient:"from-slate-900 via-blue-900 to-slate-900"},green:{name:"Vert",primary:"#10b981",primaryDark:"#059669",gradient:"from-slate-900 via-green-900 to-slate-900"},red:{name:"Rouge",primary:"#ef4444",primaryDark:"#dc2626",gradient:"from-slate-900 via-red-900 to-slate-900"},purple:{name:"Violet",primary:"#a855f7",primaryDark:"#9333ea",gradient:"from-slate-900 via-purple-900 to-slate-900"},orange:{name:"Orange",primary:"#f97316",primaryDark:"#ea580c",gradient:"from-slate-900 via-orange-900 to-slate-900"},pink:{name:"Rose",primary:"#ec4899",primaryDark:"#db2777",gradient:"from-slate-900 via-pink-900 to-slate-900"}});this.isDark=localStorage.getItem("theme")==="dark",this.colorTheme=localStorage.getItem("color-theme")||"blue",this.applyTheme(),this.applyColorTheme()}applyTheme(){this.isDark?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}applyColorTheme(){const e=this.themes[this.colorTheme],t=document.documentElement;t.style.setProperty("--color-primary",e.primary),t.style.setProperty("--color-primary-dark",e.primaryDark);const r=document.querySelector("body");if(r){r.classList.remove("from-slate-900","via-blue-900","via-green-900","via-red-900","via-purple-900","via-orange-900","via-pink-900","to-slate-900");const a=e.gradient.split(" ");r.classList.add(...a)}console.log(`üé® Th√®me de couleur appliqu√©: ${e.name}`)}toggleTheme(){return this.isDark=!this.isDark,localStorage.setItem("theme",this.isDark?"dark":"light"),this.applyTheme(),this.isDark?{message:"Mode sombre activ√© üåô",isDark:!0}:{message:"Mode clair activ√© ‚òÄÔ∏è",isDark:!1}}setColorTheme(e){this.colorTheme=e,localStorage.setItem("color-theme",e),this.applyColorTheme()}getColorTheme(){return this.colorTheme}getAvailableThemes(){return this.themes}isDarkMode(){return this.isDark}}class I{constructor(e,t){this.dataManager=e,this.uiManager=t}checkAllAlerts(){this.checkBudgetAlerts(),this.checkGoalAlerts(),this.checkRecurringAlerts()}checkBudgetAlerts(){const e=this.dataManager.getData();Object.entries(e.categories).forEach(([,t])=>{const r=t.budget>0?t.spent/t.budget*100:0;r>=80&&r<100&&this.showNotification(`‚ö†Ô∏è Attention ! Vous avez d√©pens√© ${r.toFixed(0)}% de votre budget ${t.name}`,"warning"),r>=100&&r<110&&this.showNotification(`üö® Budget ${t.name} d√©pass√© ! (${r.toFixed(0)}%)`,"error"),r>=120&&this.showNotification(`üî¥ ALERTE ! Budget ${t.name} largement d√©pass√© ! (${r.toFixed(0)}%)`,"error")})}checkGoalAlerts(){this.dataManager.getData().savingsGoals.forEach(t=>{const r=t.target>0?t.current/t.target*100:0,a=new Date(t.deadline),s=new Date,i=Math.ceil((a.getTime()-s.getTime())/(1e3*60*60*24));r>=100&&r<105&&this.showNotification(`üéâ F√©licitations ! Objectif "${t.name}" atteint !`,"success"),i<=7&&i>0&&r<100&&this.showNotification(`‚è∞ Plus que ${i} jours pour atteindre "${t.name}" (${r.toFixed(0)}%)`,"warning"),i<0&&r<100&&this.showNotification(`‚ùå Objectif "${t.name}" non atteint (${r.toFixed(0)}%)`,"error")})}checkRecurringAlerts(){const e=this.dataManager.getData(),r=new Date().getDate();e.recurringTransactions.forEach(a=>{a.active&&(a.frequency==="monthly"&&a.day-r===2&&this.showNotification(`üìÖ Rappel : "${a.name}" pr√©vu dans 2 jours (${a.amount}‚Ç¨)`,"info"),a.day===r&&this.showNotification(`üí∞ Aujourd'hui : "${a.name}" (${a.amount}‚Ç¨)`,"info"))})}showNotification(e,t="info"){this.uiManager.showNotification(e,t),"Notification"in window&&Notification.permission==="granted"&&new Notification("Budget Manager",{body:e,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png"})}async requestNotificationPermission(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.log("‚ùå Notifications non support√©es"),!1)}startPeriodicChecks(){setInterval(()=>{this.checkAllAlerts()},60*60*1e3),this.checkAllAlerts()}}class k{constructor(){u(this,"data");this.data={salary:0,currentMonth:new Date().toISOString().slice(0,7),categories:{},transactions:[],recurringTransactions:[],savingsGoals:[]}}async loadData(){try{console.log("üì° Chargement des donn√©es depuis le serveur...");const e=await window.apiClient.getData();return this.data=e,this.data.savingsGoals||(this.data.savingsGoals=[]),this.data.recurringTransactions||(this.data.recurringTransactions=[]),this.data.transactions=this.data.transactions.map((t,r)=>(t.id||(t.id=(Date.now()+r).toString()),t)),console.log("‚úÖ Donn√©es charg√©es depuis le serveur"),this.data}catch(e){throw console.error("‚ùå Erreur chargement donn√©es:",e),e}}async saveData(){try{console.log("üíæ Sauvegarde des donn√©es sur le serveur..."),await window.apiClient.saveData(this.data),console.log("‚úÖ Donn√©es sauvegard√©es sur le serveur")}catch(e){throw console.error("‚ùå Erreur sauvegarde donn√©es:",e),e}}isFirstTime(){return this.data.salary===0||Object.keys(this.data.categories).length===0}getData(){return this.data}setData(e){this.data=e}resetMonth(){Object.keys(this.data.categories).forEach(e=>{this.data.categories[e].spent=0}),this.data.transactions=[]}resetAll(){this.data={salary:0,currentMonth:new Date().toISOString().slice(0,7),categories:{},transactions:[],recurringTransactions:[],savingsGoals:[]}}exportData(){const e=JSON.stringify(this.data,null,2),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=`budget-backup-${new Date().toISOString().slice(0,10)}.json`,a.click(),URL.revokeObjectURL(r)}async importData(e){return new Promise((t,r)=>{const a=new FileReader;a.onload=s=>{var i;try{const n=JSON.parse((i=s.target)==null?void 0:i.result);this.data=n,t(this.data)}catch(n){r(n)}},a.onerror=r,a.readAsText(e)})}}class ${constructor(e){this.dataManager=e}showNotification(e,t="success"){const r=document.createElement("div");r.className="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full max-w-sm",t==="success"?(r.classList.add("bg-green-500","text-white"),r.innerHTML=`<i class="fas fa-check-circle mr-2"></i>${e}`):t==="error"?(r.classList.add("bg-red-500","text-white"),r.innerHTML=`<i class="fas fa-exclamation-circle mr-2"></i>${e}`):t==="warning"?(r.classList.add("bg-yellow-500","text-white"),r.innerHTML=`<i class="fas fa-exclamation-triangle mr-2"></i>${e}`):t==="info"&&(r.classList.add("bg-blue-500","text-white"),r.innerHTML=`<i class="fas fa-info-circle mr-2"></i>${e}`),document.body.appendChild(r),setTimeout(()=>{r.classList.remove("translate-x-full")},100),setTimeout(()=>{r.classList.add("translate-x-full"),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},300)},4e3)}showSetupScreen(){document.getElementById("setup-screen").classList.remove("hidden"),document.getElementById("dashboard-screen").classList.add("hidden"),document.getElementById("edit-budget-btn").classList.add("hidden")}showDashboard(){console.log("üìä Affichage du dashboard..."),document.getElementById("setup-screen").classList.add("hidden"),document.getElementById("dashboard-screen").classList.remove("hidden"),document.getElementById("edit-budget-btn").classList.remove("hidden"),console.log("‚úÖ Dashboard affich√©")}updateCurrentMonth(){const e=new Date,t=["Janvier","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"],r=document.getElementById("current-month");r&&(r.textContent=`${t[e.getMonth()]} ${e.getFullYear()}`)}updateSummary(e,t){const r=this.dataManager.getData();console.log("üí∞ Mise √† jour r√©sum√©:",{salary:r.salary,totalSpent:e,remaining:t});const a=document.getElementById("salary-display"),s=document.getElementById("spent-display"),i=document.getElementById("remaining-display");if(!a||!s||!i){console.warn("‚ö†Ô∏è √âl√©ments du r√©sum√© non trouv√©s, dashboard pas encore affich√©"),console.log("√âl√©ments trouv√©s:",{salaryEl:a,spentEl:s,remainingEl:i});return}a.textContent=`${r.salary.toFixed(2)}‚Ç¨`,s.textContent=`${e.toFixed(2)}‚Ç¨`,i.textContent=`${t.toFixed(2)}‚Ç¨`,console.log("‚úÖ R√©sum√© mis √† jour dans le DOM"),t<0?(i.classList.remove("text-green-700"),i.classList.add("text-red-700")):(i.classList.remove("text-red-700"),i.classList.add("text-green-700"))}updateCategoriesList(){const e=this.dataManager.getData(),t=document.getElementById("categories-list");if(!t){console.warn("‚ö†Ô∏è Container categories-list non trouv√©");return}t.innerHTML="",Object.entries(e.categories).forEach(([r,a])=>{const s=a.budget>0?a.spent/a.budget*100:0,i=a.budget-a.spent,n=document.createElement("div");n.className="category-card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 border-l-4 cursor-move",n.style.borderColor=a.color||"#6366f1",n.dataset.categoryKey=r;let o="bg-blue-500";s>100?o="bg-red-500":s>80&&(o="bg-yellow-500"),n.innerHTML=`
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-grip-vertical text-gray-400 cursor-move" title="Glisser pour r√©organiser"></i>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200">${a.name}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Budget: ${a.budget.toFixed(2)}‚Ç¨</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold ${i>=0?"text-green-600":"text-red-600"}">${i.toFixed(2)}‚Ç¨</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">restant</p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-600 dark:text-gray-400">D√©pens√©: ${a.spent.toFixed(2)}‚Ç¨</span>
                        <span class="font-semibold ${s>100?"text-red-600":"text-gray-800 dark:text-gray-200"}">${s.toFixed(1)}%</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden">
                        <div class="${o} h-full rounded-full transition-all duration-500" 
                             style="width: ${Math.min(s,100)}%"></div>
                    </div>
                </div>
                
                <button class="w-full bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition-all duration-300 text-sm font-medium view-category-btn" 
                        data-category="${r}">
                    Voir les transactions
                </button>
            `,t.appendChild(n)}),window.dispatchEvent(new CustomEvent("categories-rendered",{detail:{container:t}})),document.querySelectorAll(".view-category-btn").forEach(r=>{r.addEventListener("click",a=>{const s=a.target.dataset.category;window.budgetManager&&window.budgetManager.openTransactionsModal&&window.budgetManager.openTransactionsModal(s)})})}updateExpenseForm(){const e=this.dataManager.getData(),t=document.getElementById("expense-category");t.innerHTML='<option value="">Choisir une cat√©gorie</option>',Object.entries(e.categories).forEach(([r,a])=>{const s=document.createElement("option");s.value=r,s.textContent=a.name,t.appendChild(s)})}updateRecentTransactions(e){const t=document.getElementById("recent-transactions"),r=e.slice(-3).reverse();if(r.length===0){t.innerHTML=`
                <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                    <i class="fas fa-receipt text-4xl mb-4"></i>
                    <p>Aucune transaction r√©cente</p>
                </div>
            `;return}const a=this.dataManager.getData();t.innerHTML=r.filter(s=>a.categories[s.category]).map(s=>{const i=new Date(s.date),n=a.categories[s.category];return`
                <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 dark:text-gray-200">${s.description||"Sans description"}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">${(n==null?void 0:n.name)||s.category} ‚Ä¢ ${i.toLocaleDateString("fr-FR")}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <p class="font-bold text-red-600 text-lg">-${s.amount.toFixed(2)}‚Ç¨</p>
                        <div class="flex gap-1">
                            <button class="edit-transaction-btn text-blue-600 hover:text-blue-800 text-sm p-2 rounded transition-colors" data-transaction-id="${s.id}" title="Modifier">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-transaction-btn text-red-600 hover:text-red-800 text-sm p-2 rounded transition-colors" data-transaction-id="${s.id}" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join("")}openEditBudgetModal(){const e=this.dataManager.getData();document.getElementById("edit-salary").value=e.salary.toString(),document.getElementById("edit-budget-modal").classList.remove("hidden")}closeModal(e){document.getElementById(e).classList.add("hidden")}updateButtonColors(e){document.querySelectorAll(".filter-btn").forEach(r=>{r.classList.remove("active","bg-primary","text-white","shadow-lg","scale-105","ring-2","ring-primary","ring-opacity-50"),r.classList.add("bg-gray-200","text-gray-700","hover:bg-gray-300")});const t=document.querySelector(`[data-category="${e}"]`);t&&(t.classList.remove("bg-gray-200","text-gray-700","hover:bg-gray-300"),t.classList.add("active","bg-primary","text-white","shadow-lg","scale-105","ring-2","ring-primary","ring-opacity-50"))}updateTotalAmount(e,t){const r=e-t,a=document.getElementById("total-allocated"),s=document.getElementById("remaining-budget");if(a&&(a.textContent=t.toFixed(2)),s){s.textContent=r.toFixed(2);const i=s.parentElement;i&&(i.classList.remove("positive","negative"),r>0?i.classList.add("positive"):r<0&&i.classList.add("negative"))}}updateEditTotals(e,t){const r=e-t;document.getElementById("edit-total-allocated").textContent=t.toFixed(2),document.getElementById("edit-remaining-budget").textContent=r.toFixed(2);const a=document.querySelector(".edit-remaining-budget");a&&(a.classList.remove("text-green-500","text-red-500","text-primary"),r>0?a.classList.add("text-green-500"):r<0?a.classList.add("text-red-500"):a.classList.add("text-primary"))}}M.register(...T);class A{constructor(e,t){u(this,"chart",null);u(this,"evolutionChart",null);this.dataManager=e,this.themeManager=t}updateChart(){const e=document.getElementById("budget-chart");if(!e)return;const t=e.getContext("2d");if(!t)return;this.chart&&this.chart.destroy();const r=this.dataManager.getData(),a=Object.values(r.categories).map(n=>n.name),s=Object.values(r.categories).map(n=>n.budget),i=Object.values(r.categories).map(n=>n.spent);this.chart=new M(t,{type:"doughnut",data:{labels:a,datasets:[{label:"Budget",data:s,backgroundColor:["#6366f1","#06b6d4","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(n){const o=n.label,g=n.parsed,d=i[n.dataIndex];return`${o}: ${g.toFixed(2)}‚Ç¨ (d√©pens√©: ${d.toFixed(2)}‚Ç¨)`}}}}}}),this.updateEvolutionChart()}updateEvolutionChart(){const e=document.getElementById("evolution-chart");if(!e)return;const t=e.getContext("2d");if(!t)return;this.evolutionChart&&this.evolutionChart.destroy();const r=this.getEvolutionData(),a=this.themeManager.isDarkMode(),s=a?"#e5e7eb":"#374151",i=a?"#374151":"#e5e7eb";this.evolutionChart=new M(t,{type:"line",data:{labels:r.labels,datasets:[{label:"D√©penses totales",data:r.expenses,borderColor:"#6366f1",backgroundColor:"rgba(99, 102, 241, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#6366f1",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8},{label:"Budget total",data:r.budgets,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)",borderWidth:2,borderDash:[5,5],fill:!1,tension:.4,pointBackgroundColor:"#10b981",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{position:"top",labels:{color:s,padding:20,usePointStyle:!0}},tooltip:{backgroundColor:a?"#1f2937":"#ffffff",titleColor:s,bodyColor:s,borderColor:a?"#374151":"#e5e7eb",borderWidth:1,callbacks:{label:function(n){return`${n.dataset.label}: ${n.parsed.y.toFixed(2)}‚Ç¨`}}}},scales:{x:{grid:{color:i,display:!0},border:{display:!1},ticks:{color:s}},y:{beginAtZero:!0,grid:{color:i,display:!0},border:{display:!1},ticks:{color:s,callback:function(n){return n.toFixed(0)+"‚Ç¨"}}}}}})}getEvolutionData(){const e=this.dataManager.getData(),t=[],r=[],a=[],s=new Date;console.log("üîç Debug Evolution Chart:"),console.log("Date actuelle:",s.toISOString()),console.log("Transactions disponibles:",e.transactions.length);for(let i=5;i>=0;i--){const n=new Date(s.getFullYear(),s.getMonth()-i,1),o=n.toISOString().slice(0,7),g=n.toLocaleDateString("fr-FR",{month:"short",year:"2-digit"});t.push(g);const c=e.transactions.filter(l=>{try{const m=l.date;if(m.startsWith(o))return!0;const v=new Date(m),f=v.getFullYear(),y=v.getMonth()+1;if(`${f}-${y.toString().padStart(2,"0")}`===o)return!0;if(m.includes("/")){const E=m.split("/");if(E.length===3){const x=E[2],w=E[1].padStart(2,"0");if(`${x}-${w}`===o)return!0}}return!1}catch(m){return console.warn("Erreur parsing date:",l.date,m),!1}}).reduce((l,m)=>l+m.amount,0);r.push(c);const h=Object.values(e.categories).reduce((l,m)=>l+m.budget,0);a.push(h)}return{labels:t,expenses:r,budgets:a}}destroy(){this.chart&&(this.chart.destroy(),this.chart=null),this.evolutionChart&&(this.evolutionChart.destroy(),this.evolutionChart=null)}}class F{constructor(e){this.dataManager=e}addExpense(e,t,r){if(!e||!t||t<=0)throw new Error("Veuillez remplir tous les champs obligatoires");const a=this.dataManager.getData(),s={id:Date.now().toString(),category:e,amount:t,description:r,date:new Date().toISOString()};return a.transactions.push(s),a.categories[e].spent+=t,s}getTotalSpent(){const e=this.dataManager.getData();return Object.values(e.categories).reduce((t,r)=>t+r.spent,0)}filterTransactions(e,t=""){const r=this.dataManager.getData();let a=r.transactions;if(e!=="all"&&(a=a.filter(s=>s.category===e)),t.trim()!==""){const s=t.toLowerCase();a=a.filter(i=>{var n;return i.description.toLowerCase().includes(s)||i.amount.toString().includes(t)||(((n=r.categories[i.category])==null?void 0:n.name)||"").toLowerCase().includes(s)||new Date(i.date).toLocaleDateString("fr-FR").includes(t)})}return a}editTransaction(e,t,r,a){const s=this.dataManager.getData(),i=s.transactions.find(g=>g.id===e);if(!i)throw new Error("Transaction introuvable");if(!t||!r||r<=0)throw new Error("Veuillez remplir tous les champs obligatoires");const n=i.category,o=i.amount;return i.category=t,i.amount=r,i.description=a,n!==t?(s.categories[n].spent-=o,s.categories[t].spent+=r):s.categories[t].spent=s.categories[t].spent-o+r,{transaction:i,oldCategory:n,newCategory:t}}deleteTransaction(e){const t=this.dataManager.getData(),r=t.transactions.find(a=>a.id===e);if(!r)throw new Error("Transaction introuvable");return t.categories[r.category].spent-=r.amount,t.transactions=t.transactions.filter(a=>a.id!==e),r}getTransactionById(e){return this.dataManager.getData().transactions.find(r=>r.id===e)}getRecentTransactions(e=3){return this.dataManager.getData().transactions.slice(-e).reverse()}getTopExpenses(e=5){return[...this.dataManager.getData().transactions].sort((r,a)=>a.amount-r.amount).slice(0,e)}getCategoryStats(e){const r=this.dataManager.getData().categories[e];if(!r)return null;const a=r.budget>0?r.spent/r.budget*100:0,s=r.budget-r.spent;return{budget:r.budget,spent:r.spent,remaining:s,percentage:a}}getGlobalStats(){const e=this.dataManager.getData(),t=Object.values(e.categories).reduce((i,n)=>i+n.budget,0),r=Object.values(e.categories).reduce((i,n)=>i+n.spent,0),a=t-r,s=t>0?r/t*100:0;return{budget:t,spent:r,remaining:a,percentage:s}}}class N{constructor(e){this.dataManager=e}getCategoryDisplayName(e){return{courses:"Courses",loisirs:"Loisirs",transport:"Transport",logement:"Logement",sante:"Sant√©",autres:"Autres"}[e]||e}addCategory(e,t,r="#6366f1"){const a=this.dataManager.getData();if(!e||!t||t<0)throw new Error("Veuillez remplir tous les champs");const s=e.toLowerCase().replace(/[^a-z0-9]/g,"_");if(a.categories[s])throw new Error("Cette cat√©gorie existe d√©j√†");return a.categories[s]={name:e,budget:t,spent:0,color:r},{key:s,category:a.categories[s]}}deleteCategory(e){const t=this.dataManager.getData(),r=t.categories[e];if(!r)throw new Error("Cat√©gorie introuvable");const a=t.transactions.filter(s=>s.category===e);return delete t.categories[e],t.transactions=t.transactions.filter(s=>s.category!==e),t.recurringTransactions&&(t.recurringTransactions=t.recurringTransactions.filter(s=>s.category!==e)),{category:r,transactionsCount:a.length}}updateCategoryBudget(e,t){const r=this.dataManager.getData();if(!r.categories[e])throw new Error("Cat√©gorie introuvable");if(t<0)throw new Error("Le budget doit √™tre positif");const a=r.categories[e].budget;return r.categories[e].budget=t,r.salary>0&&(r.categories[e].percentage=t/r.salary*100),{oldBudget:a,newBudget:t}}getAllCategories(){return this.dataManager.getData().categories}getCategory(e){return this.dataManager.getData().categories[e]}getRemainingBudgetToAllocate(e=null){const t=this.dataManager.getData(),r=t.salary||0;let a=0;return Object.entries(t.categories).forEach(([s,i])=>{s!==e&&(a+=i.budget||0)}),r-a}allocateRemainingBudget(e){const t=this.dataManager.getData();if(t.salary===0)throw new Error("Veuillez d'abord saisir votre salaire mensuel");const r=this.getRemainingBudgetToAllocate(e);if(r<0)throw new Error("Le budget total d√©passe d√©j√† le salaire. R√©duisez d'abord les autres cat√©gories.");if(!t.categories[e])throw new Error("Cat√©gorie introuvable");return t.categories[e].budget=r,r}isBudgetExceeded(){const e=this.dataManager.getData();return Object.values(e.categories).reduce((r,a)=>r+(a.budget||0),0)>e.salary}getTotalBudget(){const e=this.dataManager.getData();return Object.values(e.categories).reduce((t,r)=>t+(r.budget||0),0)}}class q{constructor(e){this.dataManager=e}addSavingsGoal(e,t,r,a=0){if(!e||!t||!r)throw new Error("Veuillez remplir tous les champs obligatoires");const s=this.dataManager.getData(),i={id:Date.now().toString(),name:e,target:t,current:a,deadline:r,createdAt:new Date().toISOString(),completed:!1};return s.savingsGoals.push(i),i}addToGoal(e,t){if(!t||isNaN(t)||parseFloat(t.toString())<=0)throw new Error("Montant invalide");const a=this.dataManager.getData().savingsGoals.find(i=>i.id===e);if(!a)throw new Error("Objectif introuvable");a.current+=parseFloat(t.toString());const s=a.completed;return a.current>=a.target&&!a.completed&&(a.completed=!0),{goal:a,justCompleted:!s&&a.completed}}editGoal(e,t){if(t===null||isNaN(Number(t))||parseFloat(t.toString())<0)throw new Error("Montant invalide");const a=this.dataManager.getData().savingsGoals.find(i=>i.id===e);if(!a)throw new Error("Objectif introuvable");a.current=parseFloat(t.toString());const s=a.completed;return a.current>=a.target&&!a.completed&&(a.completed=!0),{goal:a,justCompleted:!s&&a.completed}}deleteSavingsGoal(e){const t=this.dataManager.getData(),r=t.savingsGoals.find(a=>a.id===e);if(!r)throw new Error("Objectif introuvable");return t.savingsGoals=t.savingsGoals.filter(a=>a.id!==e),r}getAllGoals(){return this.dataManager.getData().savingsGoals||[]}getGoalById(e){return this.dataManager.getData().savingsGoals.find(r=>r.id===e)}getGoalProgress(e){const t=this.getGoalById(e);if(!t)return null;const r=t.current/t.target*100,a=r>=100,s=Math.ceil((new Date(t.deadline).getTime()-new Date().getTime())/(1e3*60*60*24));return{progress:r,isCompleted:a,daysLeft:s,remaining:t.target-t.current}}}class j{constructor(e){this.dataManager=e}addRecurringTransaction(e,t,r,a,s,i=!0){if(!e||!t||!r||r<=0)throw new Error("Veuillez remplir tous les champs obligatoires");const n=this.dataManager.getData(),o={id:Date.now().toString(),name:e,category:t,amount:r,frequency:a,day:s,active:i,lastProcessed:null};return n.recurringTransactions.push(o),o}deleteRecurringTransaction(e){const t=this.dataManager.getData(),r=t.recurringTransactions.find(a=>a.id===e);if(!r)throw new Error("Transaction r√©currente introuvable");return t.recurringTransactions=t.recurringTransactions.filter(a=>a.id!==e),r}toggleRecurringTransaction(e){const r=this.dataManager.getData().recurringTransactions.find(a=>a.id===e);if(!r)throw new Error("Transaction r√©currente introuvable");return r.active=!r.active,r}processRecurringTransactions(){const e=this.dataManager.getData(),t=new Date,r=t.getDate(),a=t.toISOString().slice(0,7);let s=0;return e.recurringTransactions.forEach(i=>{if(!i.active||i.lastProcessed&&i.lastProcessed.startsWith(a))return;let n=!1;if((i.frequency==="monthly"&&r>=i.day||i.frequency==="weekly"&&t.getDay()===i.day)&&(n=!0),n){const o={id:Date.now().toString()+"_"+Math.random(),category:i.category,amount:i.amount,description:`${i.name} (r√©current)`,date:t.toISOString()};e.transactions.push(o),e.categories[i.category].spent+=i.amount,i.lastProcessed=t.toISOString(),s++}}),s}getAllRecurringTransactions(){return this.dataManager.getData().recurringTransactions||[]}getRecurringTransactionById(e){return this.dataManager.getData().recurringTransactions.find(r=>r.id===e)}}class R{constructor(e){this.dataManager=e}async exportToPDF(){const e=new S("p","mm","a4"),t=this.dataManager.getData(),r=new Date().toLocaleDateString("fr-FR"),a=new Date().toLocaleDateString("fr-FR",{month:"long",year:"numeric"});e.setFontSize(20),e.setTextColor(99,102,241),e.text("Rapport Budg√©taire",105,20,{align:"center"}),e.setFontSize(12),e.setTextColor(100,100,100),e.text(a,105,28,{align:"center"}),e.text(`G√©n√©r√© le ${r}`,105,34,{align:"center"}),e.setDrawColor(200,200,200),e.line(20,38,190,38);let s=45;e.setFontSize(14),e.setTextColor(0,0,0),e.text("üí∞ R√©sum√© Financier",20,s),s+=8;const i=Object.values(t.categories).reduce((l,m)=>l+(m.budget||0),0),n=Object.values(t.categories).reduce((l,m)=>l+(m.spent||0),0),o=i-n;e.setFontSize(11),e.setTextColor(60,60,60),e.text(`Budget total: ${i.toFixed(2)}‚Ç¨`,25,s),s+=6,e.text(`D√©pens√©: ${n.toFixed(2)}‚Ç¨`,25,s),s+=6,e.setTextColor(o>=0?34:220,o>=0?197:94,o>=0?94:38),e.text(`Restant: ${o.toFixed(2)}‚Ç¨`,25,s),s+=10,e.setFontSize(14),e.setTextColor(0,0,0),e.text("üìä D√©penses par Cat√©gorie",20,s),s+=8,e.setFontSize(10),Object.entries(t.categories).forEach(([,l])=>{s>270&&(e.addPage(),s=20);const m=l.budget>0?l.spent/l.budget*100:0;e.setTextColor(60,60,60),e.text(`${l.name}:`,25,s),e.text(`${l.spent.toFixed(2)}‚Ç¨ / ${l.budget.toFixed(2)}‚Ç¨ (${m.toFixed(1)}%)`,100,s),s+=6}),s+=5,s>240&&(e.addPage(),s=20),e.setFontSize(14),e.setTextColor(0,0,0),e.text("üèÜ Top 5 des D√©penses",20,s),s+=8;const g=t.currentMonth||new Date().toISOString().slice(0,7),d=t.transactions.filter(l=>l.date.startsWith(g)).sort((l,m)=>m.amount-l.amount).slice(0,5);e.setFontSize(10),d.forEach((l,m)=>{s>270&&(e.addPage(),s=20);const v=["ü•á","ü•à","ü•â","4Ô∏è‚É£","5Ô∏è‚É£"][m],f=t.categories[l.category];e.setTextColor(60,60,60),e.text(`${v} ${l.description||"Sans description"}`,25,s),e.text(`${l.amount.toFixed(2)}‚Ç¨`,150,s),e.setFontSize(8),e.setTextColor(120,120,120),e.text(`${(f==null?void 0:f.name)||l.category} - ${new Date(l.date).toLocaleDateString("fr-FR")}`,25,s+4),e.setFontSize(10),s+=10});const c=e.internal.getNumberOfPages();for(let l=1;l<=c;l++)e.setPage(l),e.setFontSize(8),e.setTextColor(150,150,150),e.text(`Page ${l} sur ${c}`,105,290,{align:"center"}),e.text("G√©n√©r√© par Budget Manager",105,295,{align:"center"});const h=`budget-${a.replace(/\s+/g,"-")}-${r.replace(/\//g,"-")}.pdf`;return e.save(h),h}exportData(){const e=this.dataManager.getData(),t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`budget-backup-${new Date().toISOString().slice(0,10)}.json`,s.click(),URL.revokeObjectURL(a)}async importData(e){return new Promise((t,r)=>{const a=new FileReader;a.onload=s=>{var i;try{const n=JSON.parse((i=s.target)==null?void 0:i.result);t(n)}catch{r(new Error("Fichier JSON invalide"))}},a.onerror=()=>r(new Error("Erreur de lecture du fichier")),a.readAsText(e)})}}class W{constructor(e){u(this,"draggedElement",null);u(this,"draggedKey",null);this.dataManager=e}initializeDragDrop(e){e.querySelectorAll(".category-card").forEach(r=>{const a=r;a.draggable=!0,a.addEventListener("dragstart",s=>this.handleDragStart(s)),a.addEventListener("dragend",s=>this.handleDragEnd(s)),a.addEventListener("dragover",s=>this.handleDragOver(s)),a.addEventListener("drop",s=>this.handleDrop(s)),a.addEventListener("dragenter",s=>this.handleDragEnter(s)),a.addEventListener("dragleave",s=>this.handleDragLeave(s))})}handleDragStart(e){const t=e;this.draggedElement=t.target,this.draggedKey=this.draggedElement.dataset.categoryKey||null,this.draggedElement.classList.add("opacity-50"),t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",this.draggedElement.innerHTML))}handleDragEnd(e){e.target.classList.remove("opacity-50"),document.querySelectorAll(".category-card").forEach(s=>{s.classList.remove("border-primary","border-4")})}handleDragOver(e){e.preventDefault();const t=e;t.dataTransfer&&(t.dataTransfer.dropEffect="move")}handleDragEnter(e){const a=e.target.closest(".category-card");a&&a!==this.draggedElement&&a.classList.add("border-primary","border-4")}handleDragLeave(e){const a=e.target.closest(".category-card");a&&a.classList.remove("border-primary","border-4")}handleDrop(e){e.stopPropagation(),e.preventDefault();const r=e.target.closest(".category-card");if(!r||!this.draggedElement||r===this.draggedElement)return;const a=r.dataset.categoryKey;!this.draggedKey||!a||(this.reorderCategories(this.draggedKey,a),r.classList.remove("border-primary","border-4"))}reorderCategories(e,t){const r=this.dataManager.getData(),a=r.categories,s=Object.keys(a),i=s.indexOf(e),n=s.indexOf(t);if(i===-1||n===-1)return;s.splice(i,1),s.splice(n,0,e);const o={};s.forEach((g,d)=>{o[g]={...a[g],order:d}}),r.categories=o,this.dataManager.setData(r),this.dataManager.saveData(),console.log("‚úÖ Cat√©gories r√©organis√©es"),window.dispatchEvent(new CustomEvent("categories-reordered"))}getSortedCategories(){const e=this.dataManager.getData();return Object.entries(e.categories).sort((r,a)=>{const s=r[1].order??999,i=a[1].order??999;return s-i})}}class O{constructor(e){u(this,"editMode",!1);u(this,"defaultWidgets",[{id:"summary",name:"R√©sum√© du mois",visible:!0,order:0,size:"full"},{id:"transactions",name:"Derni√®res transactions",visible:!0,order:1,size:"full"},{id:"chart",name:"R√©partition Budget",visible:!0,order:2,size:"medium"},{id:"comparison",name:"Comparaison Mensuelle",visible:!0,order:3,size:"medium"},{id:"predictions",name:"Pr√©dictions",visible:!0,order:4,size:"medium"},{id:"top-expenses",name:"Top 5 D√©penses",visible:!0,order:5,size:"medium"},{id:"stats",name:"Statistiques Avanc√©es",visible:!0,order:6,size:"medium"},{id:"recurring",name:"Transactions R√©currentes",visible:!0,order:7,size:"medium"},{id:"quick-expense",name:"Ajout Rapide",visible:!0,order:8,size:"medium"},{id:"categories",name:"Mes Cat√©gories",visible:!0,order:9,size:"full"},{id:"calendar-widget",name:"Calendrier",visible:!0,order:10,size:"full"}]);u(this,"draggedWidget",null);this.loadLayout()}loadLayout(){const e=localStorage.getItem("dashboard-layout");if(e)try{const t=JSON.parse(e);this.defaultWidgets=t.widgets,this.defaultWidgets.find(a=>a.id==="calendar-widget")||(this.defaultWidgets.push({id:"calendar-widget",name:"Calendrier",visible:!0,order:10,size:"full"}),console.log("‚úÖ Widget calendrier ajout√© √† la configuration"))}catch(t){console.error("Erreur chargement layout:",t)}}saveLayout(){const e={widgets:this.defaultWidgets};localStorage.setItem("dashboard-layout",JSON.stringify(e)),console.log("‚úÖ Layout sauvegard√©")}restoreLayout(){const e=document.querySelector("#dashboard-screen > .grid");if(!e){console.warn("‚ö†Ô∏è Container du dashboard non trouv√©");return}console.log("üîÑ Restauration du layout..."),this.getWidgets().forEach(r=>{const a=document.querySelector(`[data-widget-id="${r.id}"]`);if(a){if(r.visible||(a.style.display="none"),r.collapsed){const s=a.querySelector(".widget-content");s&&(s.style.display="none");const i=a.querySelector(".widget-collapse-toggle i");i&&(i.classList.remove("fa-chevron-up"),i.classList.add("fa-chevron-down"))}e.appendChild(a)}}),console.log("‚úÖ Layout restaur√©")}getWidgets(){return[...this.defaultWidgets].sort((e,t)=>e.order-t.order)}getVisibleWidgets(){return this.getWidgets().filter(e=>e.visible)}toggleEditMode(){return this.editMode=!this.editMode,this.editMode?this.enableEditMode():this.disableEditMode(),this.editMode}isEditMode(){return this.editMode}enableEditMode(){const e=document.getElementById("dashboard-screen");if(!e)return;e.classList.add("edit-mode"),this.defaultWidgets.forEach(r=>{const a=document.querySelector(`[data-widget-id="${r.id}"]`);a&&(a.style.display="")}),e.querySelectorAll("[data-widget-id]").forEach(r=>{const a=r,s=a.dataset.widgetId,i=this.defaultWidgets.find(c=>c.id===s);if(!i)return;const n=!i.visible;n&&(a.classList.add("widget-hidden"),a.style.opacity="0.5",a.style.filter="grayscale(100%)");const o=document.createElement("div");o.className="widget-toolbar absolute top-2 right-2 flex gap-2 bg-white dark:bg-gray-800 p-2 rounded-lg shadow-lg z-10",n?o.innerHTML=`
                    <button class="widget-show-btn p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" title="Afficher">
                        <i class="fas fa-eye text-green-600"></i>
                    </button>
                    <i class="fas fa-grip-vertical text-gray-600 dark:text-gray-400 p-2 cursor-move" title="D√©placer"></i>
                `:o.innerHTML=`
                    <button class="widget-hide-btn p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" title="Masquer">
                        <i class="fas fa-eye-slash text-red-600"></i>
                    </button>
                    <i class="fas fa-grip-vertical text-gray-600 dark:text-gray-400 p-2 cursor-move" title="D√©placer"></i>
                `,a.style.position="relative",a.classList.add("widget-editable","border-2","border-dashed","border-gray-300","dark:border-gray-600"),a.insertBefore(o,a.firstChild);const g=o.querySelector(".widget-hide-btn"),d=o.querySelector(".widget-show-btn");g==null||g.addEventListener("click",()=>this.hideWidgetInEditMode(s)),d==null||d.addEventListener("click",()=>this.showWidgetInEditMode(s)),o.addEventListener("mousedown",c=>{const h=c.target;(h.classList.contains("fa-grip-vertical")||h.closest(".fa-grip-vertical"))&&(a.draggable=!0)}),a.addEventListener("dragstart",c=>this.handleWidgetDragStart(c)),a.addEventListener("dragend",c=>{this.handleWidgetDragEnd(c),a.draggable=!1}),a.addEventListener("dragover",c=>this.handleWidgetDragOver(c)),a.addEventListener("drop",c=>this.handleWidgetDrop(c)),a.addEventListener("dragenter",c=>this.handleWidgetDragEnter(c)),a.addEventListener("dragleave",c=>this.handleWidgetDragLeave(c))})}disableEditMode(){const e=document.getElementById("dashboard-screen");if(!e)return;e.classList.remove("edit-mode"),document.querySelectorAll("[data-widget-id]").forEach(r=>{const a=r,s=a.dataset.widgetId,i=this.defaultWidgets.find(o=>o.id===s);a.classList.remove("widget-editable","widget-hidden","border-2","border-dashed","border-gray-300","dark:border-gray-600"),a.draggable=!1,a.style.position="",a.style.opacity="",a.style.filter="",a.querySelectorAll(".widget-toolbar").forEach(o=>o.remove()),i&&!i.visible&&(a.style.display="none")}),this.saveLayout(),console.log("‚úÖ Mode √©dition d√©sactiv√©")}hideWidget(e){const t=this.defaultWidgets.find(r=>r.id===e);if(t){t.visible=!1,this.saveLayout();const r=document.querySelector(`[data-widget-id="${e}"]`);r&&(r.style.display="none")}}hideWidgetInEditMode(e){const t=this.defaultWidgets.find(r=>r.id===e);if(t){t.visible=!1,this.saveLayout();const r=document.querySelector(`[data-widget-id="${e}"]`);if(r){r.classList.add("widget-hidden"),r.style.opacity="0.5",r.style.filter="grayscale(100%)";const a=r.querySelector(".widget-toolbar");if(a){a.innerHTML=`
                        <button class="widget-show-btn p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" title="Afficher">
                            <i class="fas fa-eye text-green-600"></i>
                        </button>
                        <button class="widget-drag-handle p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-move" title="D√©placer">
                            <i class="fas fa-grip-vertical text-gray-600 dark:text-gray-400"></i>
                        </button>
                    `;const s=a.querySelector(".widget-show-btn");s==null||s.addEventListener("click",()=>this.showWidgetInEditMode(e))}console.log(`‚úÖ Widget "${t.name}" masqu√©`)}}}showWidgetInEditMode(e){const t=this.defaultWidgets.find(r=>r.id===e);if(t){t.visible=!0,this.saveLayout();const r=document.querySelector(`[data-widget-id="${e}"]`);if(r){r.classList.remove("widget-hidden"),r.style.opacity="",r.style.filter="";const a=r.querySelector(".widget-toolbar");if(a){a.innerHTML=`
                        <button class="widget-hide-btn p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" title="Masquer">
                            <i class="fas fa-eye-slash text-red-600"></i>
                        </button>
                        <button class="widget-drag-handle p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-move" title="D√©placer">
                            <i class="fas fa-grip-vertical text-gray-600 dark:text-gray-400"></i>
                        </button>
                    `;const s=a.querySelector(".widget-hide-btn");s==null||s.addEventListener("click",()=>this.hideWidgetInEditMode(e))}console.log(`‚úÖ Widget "${t.name}" r√©affich√©`)}}}showWidget(e){const t=this.defaultWidgets.find(r=>r.id===e);if(t){t.visible=!0,this.saveLayout();const r=document.querySelector(`[data-widget-id="${e}"]`);r&&(r.style.display=""),console.log(`‚úÖ Widget "${t.name}" r√©affich√©`)}}toggleWidgetCollapse(e){const t=document.querySelector(`[data-widget-id="${e}"]`);if(!t){console.warn(`‚ö†Ô∏è Widget ${e} non trouv√©`);return}const r=this.defaultWidgets.find(g=>g.id===e);if(!r){console.warn(`‚ö†Ô∏è Config widget ${e} non trouv√©e`);return}let a=t.querySelector(".widget-content");if(!a){console.warn(`‚ö†Ô∏è Contenu du widget ${e} non trouv√©`);return}const s=t.querySelector(".widget-collapse-btn i"),i=t.querySelector(".widget-collapse-toggle i"),n=s||i,o=a.style.display==="none";console.log(`üîÑ Toggle widget ${e}, actuellement ${o?"pli√©":"d√©pli√©"}`),o?(a.style.display="",r.collapsed=!1,n&&(n.classList.remove("fa-chevron-down"),n.classList.add("fa-chevron-up"))):(a.style.display="none",r.collapsed=!0,n&&(n.classList.remove("fa-chevron-up"),n.classList.add("fa-chevron-down"))),this.saveLayout(),console.log(`‚úÖ Widget "${r.name}" ${r.collapsed?"pli√©":"d√©pli√©"}`)}handleWidgetDragStart(e){const t=e;this.draggedWidget=t.target.closest("[data-widget-id]"),this.draggedWidget&&(this.draggedWidget.classList.add("opacity-50"),t.dataTransfer&&(t.dataTransfer.effectAllowed="move"))}handleWidgetDragEnd(e){this.draggedWidget&&this.draggedWidget.classList.remove("opacity-50"),document.querySelectorAll("[data-widget-id]").forEach(t=>{t.classList.remove("border-primary","border-4")})}handleWidgetDragOver(e){e.preventDefault();const t=e;t.dataTransfer&&(t.dataTransfer.dropEffect="move")}handleWidgetDragEnter(e){const t=e.target.closest("[data-widget-id]");t&&t!==this.draggedWidget&&t.classList.add("border-primary","border-4")}handleWidgetDragLeave(e){const t=e.target.closest("[data-widget-id]");t&&t.classList.remove("border-primary","border-4")}handleWidgetDrop(e){e.preventDefault(),e.stopPropagation();const t=e.target.closest("[data-widget-id]");if(!t||!this.draggedWidget||t===this.draggedWidget)return;const r=this.draggedWidget.dataset.widgetId,a=t.dataset.widgetId;r&&a&&this.reorderWidgets(r,a),t.classList.remove("border-primary","border-4")}reorderWidgets(e,t){const r=this.defaultWidgets.find(n=>n.id===e),a=this.defaultWidgets.find(n=>n.id===t);if(!r||!a)return;const s=r.order,i=a.order;r.order=i,a.order=s,this.saveLayout(),this.reorderDOM(e,t),console.log("‚úÖ Widgets r√©organis√©s:",{draggedId:e,dropId:t})}reorderDOM(e,t){const r=document.querySelector("#dashboard-screen > .grid");if(!r)return;const a=document.querySelector(`[data-widget-id="${e}"]`),s=document.querySelector(`[data-widget-id="${t}"]`);if(!(!a||!s)&&(r.insertBefore(a,s),this.editMode)){const i=this.editMode;this.editMode=!1,this.disableEditMode(),setTimeout(()=>{this.editMode=i,this.enableEditMode()},50)}}openWidgetsModal(){const e=document.getElementById("widgets-modal"),t=document.getElementById("widgets-list");if(!e||!t)return;const r=this.defaultWidgets.filter(i=>i.visible),a=this.defaultWidgets.filter(i=>!i.visible);let s="";r.length>0&&(s+='<div class="mb-4"><h4 class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Widgets Affich√©s</h4>',s+=r.map(i=>`
                <div class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg mb-2">
                    <i class="fas fa-eye text-green-500"></i>
                    <span class="flex-1 text-gray-800 dark:text-gray-200 font-medium">${i.name}</span>
                    <button class="hide-widget-btn text-red-500 hover:text-red-700 transition-colors" data-widget-id="${i.id}" title="Masquer">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                </div>
            `).join(""),s+="</div>"),a.length>0&&(s+='<div><h4 class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Widgets Masqu√©s</h4>',s+=a.map(i=>`
                <div class="flex items-center gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg mb-2 opacity-60">
                    <i class="fas fa-eye-slash text-red-500"></i>
                    <span class="flex-1 text-gray-800 dark:text-gray-200 font-medium line-through">${i.name}</span>
                    <button class="show-widget-btn text-green-500 hover:text-green-700 transition-colors" data-widget-id="${i.id}" title="Afficher">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            `).join(""),s+="</div>"),r.length===0&&a.length===0&&(s='<p class="text-center text-gray-500 dark:text-gray-400 py-4">Aucun widget disponible</p>'),t.innerHTML=s,t.querySelectorAll(".hide-widget-btn").forEach(i=>{i.addEventListener("click",n=>{const g=n.currentTarget.dataset.widgetId;g&&(this.hideWidget(g),this.openWidgetsModal())})}),t.querySelectorAll(".show-widget-btn").forEach(i=>{i.addEventListener("click",n=>{const g=n.currentTarget.dataset.widgetId;g&&(this.showWidget(g),this.openWidgetsModal())})}),e.classList.remove("hidden")}closeWidgetsModal(){const e=document.getElementById("widgets-modal");e&&e.classList.add("hidden")}resetLayout(){confirm("√ätes-vous s√ªr de vouloir r√©initialiser le layout ? Tous vos widgets seront r√©affich√©s dans l'ordre par d√©faut.")&&(localStorage.removeItem("dashboard-layout"),this.defaultWidgets=[{id:"summary",name:"R√©sum√© du mois",visible:!0,order:0,size:"full"},{id:"transactions",name:"Derni√®res transactions",visible:!0,order:1,size:"full"},{id:"chart",name:"R√©partition Budget",visible:!0,order:2,size:"medium"},{id:"comparison",name:"Comparaison Mensuelle",visible:!0,order:3,size:"medium"},{id:"predictions",name:"Pr√©dictions",visible:!0,order:4,size:"medium"},{id:"top-expenses",name:"Top 5 D√©penses",visible:!0,order:5,size:"medium"},{id:"stats",name:"Statistiques Avanc√©es",visible:!0,order:6,size:"medium"},{id:"recurring",name:"Transactions R√©currentes",visible:!0,order:7,size:"medium"},{id:"quick-expense",name:"Ajout Rapide",visible:!0,order:8,size:"medium"},{id:"categories",name:"Mes Cat√©gories",visible:!0,order:9,size:"full"},{id:"calendar-widget",name:"Calendrier",visible:!0,order:10,size:"full"}],this.defaultWidgets.forEach(e=>{const t=document.querySelector(`[data-widget-id="${e.id}"]`);t&&(t.style.display="")}),this.saveLayout(),this.restoreLayout(),this.closeWidgetsModal(),window.dispatchEvent(new CustomEvent("widgets-changed")))}}class P{constructor(e){u(this,"currentMonth");this.dataManager=e,this.currentMonth=new Date}getCurrentMonth(){return this.currentMonth}setMonth(e,t){this.currentMonth=new Date(e,t,1)}nextMonth(){this.currentMonth.setMonth(this.currentMonth.getMonth()+1)}prevMonth(){this.currentMonth.setMonth(this.currentMonth.getMonth()-1)}getMonthDays(){const e=this.currentMonth.getFullYear(),t=this.currentMonth.getMonth(),r=new Date(e,t,1),a=new Date(e,t+1,0);let s=r.getDay();s=s===0?6:s-1;const i=[],n=new Date;n.setHours(0,0,0,0);const o=new Date(e,t,0).getDate();for(let d=s-1;d>=0;d--){const c=new Date(e,t-1,o-d);i.push({date:c,isCurrentMonth:!1,isToday:!1,transactions:this.getTransactionsForDate(c),recurringTransactions:this.getRecurringForDate(c)})}for(let d=1;d<=a.getDate();d++){const c=new Date(e,t,d),h=c.getTime()===n.getTime();i.push({date:c,isCurrentMonth:!0,isToday:h,transactions:this.getTransactionsForDate(c),recurringTransactions:this.getRecurringForDate(c)})}const g=42-i.length;for(let d=1;d<=g;d++){const c=new Date(e,t+1,d);i.push({date:c,isCurrentMonth:!1,isToday:!1,transactions:this.getTransactionsForDate(c),recurringTransactions:this.getRecurringForDate(c)})}return i}getTransactionsForDate(e){const t=this.dataManager.getData(),r=e.toISOString().split("T")[0];return t.transactions.filter(a=>new Date(a.date).toISOString().split("T")[0]===r)}getRecurringForDate(e){const t=this.dataManager.getData(),r=e.getDate();return t.recurringTransactions.filter(a=>a.active&&a.frequency==="monthly"?a.day===r:!1)}getMonthName(){return this.currentMonth.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}getMonthlyProjection(){const e=this.getMonthDays();let t=0;return e.forEach(r=>{r.isCurrentMonth&&(r.transactions.forEach(a=>{t+=a.amount}),r.recurringTransactions.forEach(a=>{t+=a.amount}))}),t}}class z{constructor(){u(this,"touchStartX",0);u(this,"touchStartY",0);u(this,"touchEndX",0);u(this,"touchEndY",0);u(this,"minSwipeDistance",50);this.initializeGestures()}initializeGestures(){this.isMobile()&&(console.log("üì± Initialisation des gestes tactiles..."),this.initializeTransactionSwipe(),this.initializeCategorySwipe(),this.initializePullToRefresh(),console.log("‚úÖ Gestes tactiles initialis√©s"))}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}initializeTransactionSwipe(){document.addEventListener("touchstart",e=>{e.target.closest("[data-transaction-id]")&&(this.touchStartX=e.touches[0].clientX,this.touchStartY=e.touches[0].clientY)},{passive:!0}),document.addEventListener("touchmove",e=>{const r=e.target.closest("[data-transaction-id]");if(r){this.touchEndX=e.touches[0].clientX,this.touchEndY=e.touches[0].clientY;const a=this.touchEndX-this.touchStartX,s=Math.abs(this.touchEndY-this.touchStartY);Math.abs(a)>s&&(e.preventDefault(),r.style.transform=`translateX(${a}px)`,r.style.transition="none",Math.abs(a)>this.minSwipeDistance&&(r.style.backgroundColor=a<0?"#fee2e2":"#dbeafe"))}},{passive:!1}),document.addEventListener("touchend",e=>{const r=e.target.closest("[data-transaction-id]");if(r){const a=this.touchEndX-this.touchStartX;if(r.style.transition="transform 0.3s ease, background-color 0.3s ease",a<-this.minSwipeDistance*2){const s=r.dataset.transactionId;s&&window.dispatchEvent(new CustomEvent("delete-transaction-swipe",{detail:{transactionId:s}}))}else r.style.transform="",r.style.backgroundColor="";this.touchStartX=0,this.touchEndX=0}})}initializeCategorySwipe(){let e=null;document.addEventListener("touchstart",t=>{e=t.target.closest("#categories-list"),e&&(this.touchStartX=t.touches[0].clientX)},{passive:!0}),document.addEventListener("touchmove",t=>{if(e){this.touchEndX=t.touches[0].clientX;const r=this.touchEndX-this.touchStartX;Math.abs(r)>10&&(e.scrollLeft-=r/2)}},{passive:!0})}initializePullToRefresh(){let e=0,t=!1;const r=80;document.addEventListener("touchstart",a=>{window.scrollY===0&&(e=a.touches[0].clientY,t=!0)},{passive:!0}),document.addEventListener("touchmove",a=>{if(!t)return;const i=a.touches[0].clientY-e;if(i>0&&i<r*2){const n=document.getElementById("pull-refresh-indicator");n&&(n.style.transform=`translateY(${Math.min(i,r)}px)`,n.style.opacity=`${Math.min(i/r,1)}`)}},{passive:!0}),document.addEventListener("touchend",a=>{if(!t)return;a.changedTouches[0].clientY-e>r&&window.dispatchEvent(new CustomEvent("pull-to-refresh"));const n=document.getElementById("pull-refresh-indicator");n&&(n.style.transform="",n.style.opacity="0"),t=!1})}detectTap(e,t){let r=0;const a=200;e.addEventListener("touchstart",()=>{r=Date.now()},{passive:!0}),e.addEventListener("touchend",s=>{Date.now()-r<a&&(s.preventDefault(),t())})}detectLongPress(e,t){let r;e.addEventListener("touchstart",()=>{r=window.setTimeout(()=>{t()},500)},{passive:!0}),e.addEventListener("touchend",()=>{clearTimeout(r)}),e.addEventListener("touchmove",()=>{clearTimeout(r)})}}class G{constructor(){u(this,"dataManager");u(this,"themeManager");u(this,"uiManager");u(this,"chartManager");u(this,"transactionManager");u(this,"categoryManager");u(this,"savingsManager");u(this,"recurringManager");u(this,"exportManager");u(this,"notificationManager");u(this,"dragDropManager");u(this,"widgetManager");u(this,"calendarManager");u(this,"_touchGestureManager");u(this,"lastAlertKey",null);u(this,"lastAlertAt",0);u(this,"editingTransactionId",null);this.dataManager=new k,this.themeManager=new C,this.uiManager=new $(this.dataManager),this.chartManager=new A(this.dataManager,this.themeManager),this.transactionManager=new F(this.dataManager),this.categoryManager=new N(this.dataManager),this.savingsManager=new q(this.dataManager),this.recurringManager=new j(this.dataManager),this.exportManager=new R(this.dataManager),this.notificationManager=new I(this.dataManager,this.uiManager),this.dragDropManager=new W(this.dataManager),this.widgetManager=new O(this.dataManager),this.calendarManager=new P(this.dataManager),this._touchGestureManager=new z,this.init()}async init(){console.log("üöÄ Initialisation de l'application...");let e=3,t=!1;for(;e>0&&!t;)try{await this.dataManager.loadData(),t=!0,console.log("‚úÖ Donn√©es charg√©es avec succ√®s")}catch{e--,e>0?(console.log(`‚ö†Ô∏è Erreur chargement, nouvelle tentative... (${e} restantes)`),await new Promise(a=>setTimeout(a,500))):(console.error("‚ùå Impossible de charger les donn√©es apr√®s 3 tentatives"),this.uiManager.showNotification("Erreur de connexion au serveur","error"),this.dataManager.setData({salary:0,currentMonth:new Date().toISOString().slice(0,7),categories:{},transactions:[],recurringTransactions:[],savingsGoals:[]}))}this.recurringManager.processRecurringTransactions(),setTimeout(()=>{this.setupEventListeners()},100),this.uiManager.updateCurrentMonth(),this.dataManager.isFirstTime()?this.uiManager.showSetupScreen():this.showDashboard(),this.notificationManager.requestNotificationPermission(),this.notificationManager.startPeriodicChecks(),window.addEventListener("categories-rendered",r=>{const s=r.detail.container;s&&this.dragDropManager.initializeDragDrop(s)}),window.addEventListener("categories-reordered",()=>{this.updateDashboard(),this.uiManager.showNotification("‚úÖ Cat√©gories r√©organis√©es","success")}),window.addEventListener("pull-to-refresh",()=>{this.handlePullToRefresh()}),window.addEventListener("delete-transaction-swipe",r=>{const s=r.detail.transactionId;s&&this.deleteTransaction(s)}),console.log("‚ú® Application pr√™te !")}showDashboard(){this.uiManager.showDashboard(),setTimeout(()=>{this.updateDashboard(),this.widgetManager.restoreLayout()},50)}updateDashboard(){const e=this.transactionManager.getTotalSpent(),t=this.dataManager.getData(),r=t.salary-e;this.uiManager.updateSummary(e,r),this.uiManager.updateCategoriesList(),this.uiManager.updateExpenseForm(),this.uiManager.updateRecentTransactions(t.transactions),this.chartManager.updateChart(),this.updateSavingsGoals(),this.updateRecurringTransactions(),this.updateTopExpenses(),this.renderWidgetCalendar()}setupEventListeners(){console.log("üîß Configuration des event listeners..."),document.getElementById("setup-form").addEventListener("submit",n=>{n.preventDefault(),this.handleSetup()}),document.querySelectorAll('#categories-setup input[type="number"]').forEach(n=>{n.addEventListener("input",()=>this.updateTotalAmount())});const t=document.getElementById("monthly-salary");t&&t.addEventListener("input",()=>this.updateTotalAmount()),document.querySelectorAll(".btn-rest").forEach(n=>{n.addEventListener("click",o=>{const g=o.target;this.allocateRemainingBudget(g.dataset.category)})}),document.getElementById("expense-form").addEventListener("submit",n=>{n.preventDefault(),this.addExpense()}),document.getElementById("edit-budget-btn").addEventListener("click",()=>{this.openEditBudgetModal()}),document.getElementById("show-all-transactions-btn").addEventListener("click",()=>{this.openTransactionsModal("all")}),document.addEventListener("click",n=>{var g;const o=n.target;if(o.matches('[data-category="all"]')){this.uiManager.updateButtonColors("all");const d=((g=document.getElementById("transaction-search"))==null?void 0:g.value)||"";this.filterTransactions("all",d)}if(o.closest(".edit-transaction-btn")){const d=o.closest(".edit-transaction-btn").dataset.transactionId;this.openEditTransactionModal(d)}if(o.closest(".delete-transaction-btn")){const d=o.closest(".delete-transaction-btn").dataset.transactionId;this.deleteTransaction(d)}}),document.getElementById("settings-btn").addEventListener("click",()=>{document.getElementById("settings-modal").classList.remove("hidden")}),document.querySelector(".close-modal").addEventListener("click",()=>{document.getElementById("settings-modal").classList.add("hidden")}),document.querySelectorAll(".close-edit-modal").forEach(n=>{n.addEventListener("click",()=>{document.getElementById("edit-budget-modal").classList.add("hidden")})}),document.getElementById("edit-budget-form").addEventListener("submit",n=>{n.preventDefault(),this.saveEditedBudgets()}),document.getElementById("edit-salary").addEventListener("input",()=>{this.updateEditTotals()}),document.querySelectorAll(".close-all-transactions-modal").forEach(n=>{n.addEventListener("click",()=>{document.getElementById("all-transactions-modal").classList.add("hidden")})}),document.getElementById("all-transactions-modal").addEventListener("click",n=>{n.target.id==="all-transactions-modal"&&document.getElementById("all-transactions-modal").classList.add("hidden")}),document.querySelectorAll(".close-edit-transaction-modal").forEach(n=>{n.addEventListener("click",()=>{document.getElementById("edit-transaction-modal").classList.add("hidden")})}),document.getElementById("edit-transaction-modal").addEventListener("click",n=>{n.target.id==="edit-transaction-modal"&&document.getElementById("edit-transaction-modal").classList.add("hidden")}),document.getElementById("edit-transaction-form").addEventListener("submit",n=>{n.preventDefault(),this.saveEditedTransaction()}),document.addEventListener("click",n=>{const o=n.target;o.closest("#reset-month-btn")&&(console.log("üîÑ R√©initialiser le mois cliqu√©"),n.preventDefault(),this.resetMonth()),o.closest("#export-data-btn")&&(console.log("üíæ Export donn√©es cliqu√©"),n.preventDefault(),this.exportData()),o.closest("#import-data-btn")&&(console.log("üì• Import donn√©es cliqu√©"),n.preventDefault(),document.getElementById("import-file").click()),o.closest("#load-template-btn")&&(console.log("üé® Charger template cliqu√©"),n.preventDefault(),this.showTemplateModal()),o.closest("#reset-all-btn")&&(console.log("üóëÔ∏è Tout r√©initialiser cliqu√©"),n.preventDefault(),confirm("√ätes-vous s√ªr de vouloir tout r√©initialiser ? Cette action est irr√©versible.")&&this.resetAll())}),document.getElementById("import-file").addEventListener("change",n=>{this.importData(n)}),document.getElementById("theme-toggle").addEventListener("click",()=>{this.toggleTheme()}),document.getElementById("color-theme-btn").addEventListener("click",()=>{this.openColorThemeModal()}),document.querySelector(".close-color-theme-modal").addEventListener("click",()=>{this.closeColorThemeModal()}),document.querySelectorAll(".color-theme-option").forEach(n=>{n.addEventListener("click",o=>{var c;const d=o.currentTarget.dataset.theme;if(d&&["blue","green","red","purple","orange","pink"].includes(d)){this.themeManager.setColorTheme(d);const l=((c=this.themeManager.getAvailableThemes()[d])==null?void 0:c.name)||d;this.uiManager.showNotification(`üé® Th√®me ${l} appliqu√©`,"success"),this.closeColorThemeModal(),this.chartManager&&this.chartManager.updateChart()}})}),document.getElementById("edit-mode-btn").addEventListener("click",()=>{const n=this.widgetManager.toggleEditMode(),o=document.getElementById("edit-mode-btn");n?(o.classList.remove("bg-purple-500","hover:bg-purple-600"),o.classList.add("bg-green-500","hover:bg-green-600"),o.innerHTML='<i class="fas fa-save"></i> <span class="hidden md:inline">Sauvegarder</span>',this.uiManager.showNotification("üé® Mode √âdition activ√© - Les widgets masqu√©s apparaissent en gris√©","info")):(o.classList.remove("bg-green-500","hover:bg-green-600"),o.classList.add("bg-purple-500","hover:bg-purple-600"),o.innerHTML='<i class="fas fa-edit"></i> <span class="hidden md:inline">√âditer</span>',this.uiManager.showNotification("‚úÖ Layout sauvegard√©","success"))}),document.querySelectorAll(".close-widgets-modal").forEach(n=>{n.addEventListener("click",()=>{this.widgetManager.closeWidgetsModal()})}),document.getElementById("reset-layout-btn").addEventListener("click",()=>{this.widgetManager.resetLayout()}),document.getElementById("widget-prev-month-btn").addEventListener("click",()=>{this.calendarManager.prevMonth(),this.renderWidgetCalendar()}),document.getElementById("widget-next-month-btn").addEventListener("click",()=>{this.calendarManager.nextMonth(),this.renderWidgetCalendar()}),document.addEventListener("click",n=>{const g=n.target.closest(".widget-collapse-toggle");if(g){n.stopPropagation();const d=g.dataset.widget;d&&this.widgetManager.toggleWidgetCollapse(d)}}),document.getElementById("export-pdf-btn").addEventListener("click",()=>{this.exportToPDF()}),document.getElementById("add-recurring-btn").addEventListener("click",()=>{this.openRecurringModal()}),document.querySelectorAll(".close-recurring-modal").forEach(n=>{n.addEventListener("click",()=>{document.getElementById("recurring-modal").classList.add("hidden")})}),document.getElementById("recurring-form").addEventListener("submit",n=>{n.preventDefault(),this.addRecurringTransaction()}),document.querySelectorAll(".close-template-modal").forEach(n=>{n.addEventListener("click",()=>{document.getElementById("template-modal").classList.add("hidden")})}),document.getElementById("add-category-btn").addEventListener("click",()=>{document.getElementById("new-category-modal").classList.remove("hidden")}),document.querySelectorAll(".close-new-category-modal").forEach(n=>{n.addEventListener("click",()=>{document.getElementById("new-category-modal").classList.add("hidden")})}),document.getElementById("new-category-form").addEventListener("submit",n=>{n.preventDefault(),this.addNewCategory()}),document.addEventListener("click",n=>{const o=n.target;if(o.classList.contains("color-preset")){const g=o.dataset.color;document.getElementById("new-category-color").value=g}});const a=document.getElementById("fab-add-expense"),s=document.getElementById("quick-expense-modal"),i=document.getElementById("quick-expense-form");a&&s&&i&&(a.addEventListener("click",()=>{this.openQuickExpenseModal()}),document.querySelectorAll(".close-quick-expense").forEach(n=>{n.addEventListener("click",()=>s.classList.add("hidden"))}),s.addEventListener("click",n=>{n.target.id==="quick-expense-modal"&&s.classList.add("hidden")}),i.addEventListener("submit",n=>{n.preventDefault(),this.addQuickExpense()})),document.addEventListener("keydown",n=>{n.ctrlKey&&n.key==="n"?(n.preventDefault(),document.getElementById("expense-amount").focus(),this.uiManager.showNotification("üí° Raccourci: Nouvelle d√©pense")):n.ctrlKey&&n.key==="t"?(n.preventDefault(),this.toggleTheme()):n.key==="Escape"&&document.querySelectorAll(".fixed.inset-0").forEach(o=>{o.classList.contains("hidden")||o.classList.add("hidden")})}),document.addEventListener("input",n=>{const o=n.target;o.id==="transaction-search"&&this.handleTransactionSearch(o.value)}),document.addEventListener("click",n=>{n.target.closest("#clear-search")&&(document.getElementById("transaction-search").value="",document.getElementById("clear-search").classList.add("hidden"),this.handleTransactionSearch(""))}),document.getElementById("settings-modal").addEventListener("click",n=>{n.target.id==="settings-modal"&&document.getElementById("settings-modal").classList.add("hidden")})}handleSetup(){const e=parseFloat(document.getElementById("monthly-salary").value),t=document.querySelectorAll('#categories-setup input[type="number"]');if(e<=0){alert("Veuillez saisir un salaire valide");return}let r=0;if(t.forEach(s=>{r+=parseFloat(s.value)||0}),r>e){alert("Le total des budgets d√©passe votre salaire. Veuillez ajuster les montants.");return}const a=this.dataManager.getData();a.salary=e,a.categories={},t.forEach(s=>{const i=s.name,n=parseFloat(s.value)||0,o=this.categoryManager.getCategoryDisplayName(i);a.categories[i]={name:o,budget:n,spent:0,percentage:n/e*100}}),this.dataManager.saveData(),this.showDashboard()}updateTotalAmount(){const e=document.getElementById("monthly-salary"),t=parseFloat(e.value)||0,r=document.querySelectorAll('#categories-setup input[type="number"]');let a=0;r.forEach(s=>{a+=parseFloat(s.value)||0}),this.uiManager.updateTotalAmount(t,a)}allocateRemainingBudget(e){try{const t=document.getElementById("monthly-salary");if((parseFloat(t.value)||0)===0){alert("Veuillez d'abord saisir votre salaire mensuel");return}const a=this.categoryManager.getRemainingBudgetToAllocate(e);if(a<0){alert("Le budget total d√©passe d√©j√† le salaire. R√©duisez d'abord les autres cat√©gories.");return}const s=document.querySelector(`input[name="${e}"]`);s&&(s.value=a.toFixed(2),this.updateTotalAmount(),this.uiManager.showNotification(`${a.toFixed(2)}‚Ç¨ allou√©s`))}catch(t){this.uiManager.showNotification(t.message,"error")}}addExpense(){try{const e=document.getElementById("expense-category").value,t=parseFloat(document.getElementById("expense-amount").value),r=document.getElementById("expense-description").value;this.transactionManager.addExpense(e,t,r),this.dataManager.saveData(),this.updateDashboard(),document.getElementById("expense-form").reset();const a=this.dataManager.getData();this.uiManager.showNotification(`D√©pense de ${t.toFixed(2)}‚Ç¨ ajout√©e √† ${a.categories[e].name}`),this.checkAdvancedAlerts({changedCategory:e})}catch(e){this.uiManager.showNotification(e.message,"error")}}addQuickExpense(){var e,t,r;try{const a=((e=document.getElementById("quick-expense-category"))==null?void 0:e.value)||"",s=parseFloat(((t=document.getElementById("quick-expense-amount"))==null?void 0:t.value)||"0"),i=((r=document.getElementById("quick-expense-description"))==null?void 0:r.value)||"";this.transactionManager.addExpense(a,s,i),this.dataManager.saveData(),this.updateDashboard();const n=this.dataManager.getData();this.uiManager.showNotification(`D√©pense de ${s.toFixed(2)}‚Ç¨ ajout√©e √† ${n.categories[a].name}`),this.checkAdvancedAlerts({changedCategory:a}),document.getElementById("quick-expense-form").reset(),document.getElementById("quick-expense-modal").classList.add("hidden")}catch(a){this.uiManager.showNotification(a.message,"error")}}openQuickExpenseModal(){const e=this.dataManager.getData(),t=document.getElementById("quick-expense-category");t&&(t.innerHTML='<option value="">Choisir une cat√©gorie</option>',Object.entries(e.categories).forEach(([r,a])=>{const s=document.createElement("option");s.value=r,s.textContent=a.name,t.appendChild(s)})),document.getElementById("quick-expense-modal").classList.remove("hidden"),setTimeout(()=>{var r;return(r=document.getElementById("quick-expense-amount"))==null?void 0:r.focus()},50)}toggleTheme(){const e=this.themeManager.toggleTheme();this.uiManager.showNotification(e.message),this.chartManager&&this.chartManager.updateChart()}resetMonth(){this.dataManager.resetMonth(),this.dataManager.saveData(),this.updateDashboard(),this.uiManager.showNotification("Nouveau mois initialis√© !"),document.getElementById("settings-modal").classList.add("hidden")}exportData(){this.exportManager.exportData(),this.uiManager.showNotification("Donn√©es export√©es avec succ√®s !")}async importData(e){var a;const r=(a=e.target.files)==null?void 0:a[0];if(r){try{const s=await this.exportManager.importData(r);if(confirm("√ätes-vous s√ªr de vouloir importer ces donn√©es ? Cela remplacera vos donn√©es actuelles.")){const i=this.dataManager.getData();this.dataManager.setData({...i,...s}),await this.dataManager.saveData(),this.updateDashboard(),this.uiManager.showNotification("Donn√©es import√©es avec succ√®s !")}}catch(s){this.uiManager.showNotification(s.message,"error")}document.getElementById("settings-modal").classList.add("hidden")}}async resetAll(){this.dataManager.resetAll(),await this.dataManager.saveData(),location.reload()}async exportToPDF(){try{this.uiManager.showNotification("üìÑ G√©n√©ration du PDF en cours..."),await this.exportManager.exportToPDF(),this.uiManager.showNotification("‚úÖ PDF export√© avec succ√®s !")}catch(e){console.error("Erreur export PDF:",e),this.uiManager.showNotification("‚ùå Erreur lors de l'export PDF","error")}}checkAdvancedAlerts(e={}){try{const t=this.dataManager.getData(),r=Object.values(t.categories).reduce((h,l)=>h+(l.budget||0),0),a=Object.values(t.categories).reduce((h,l)=>h+(l.spent||0),0),s=r>0?a/r*100:0,i=[];if(s>=100?i.push("‚ö†Ô∏è Budget global d√©pass√© !"):s>=80&&i.push("‚ö†Ô∏è Vous avez d√©pass√© 80% du budget global"),(e.changedCategory?[e.changedCategory]:Object.keys(t.categories)).forEach(h=>{const l=t.categories[h];if(!l)return;const m=l.budget>0?l.spent/l.budget*100:0;m>=100?i.push(`üö® Cat√©gorie ${l.name}: budget d√©pass√© !`):m>=80&&i.push(`‚ö†Ô∏è Cat√©gorie ${l.name}: 80% du budget utilis√©`)}),i.length===0)return;const o=[...new Set(i)],g=o.join("|"),d=Date.now();if(this.lastAlertKey===g&&d-this.lastAlertAt<4e3)return;this.lastAlertKey=g,this.lastAlertAt=d;const c=o.join("<br>");this.uiManager.showNotification(c,"error")}catch{}}openEditBudgetModal(){this.uiManager.openEditBudgetModal(),this.populateEditCategories(),this.updateEditTotals()}populateEditCategories(){const e=this.dataManager.getData(),t=document.getElementById("edit-categories-list");t.innerHTML="",Object.entries(e.categories).forEach(([r,a])=>{const s=document.createElement("div");s.className="flex items-center gap-3 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg",s.innerHTML=`
                <label class="flex-1 font-semibold text-gray-800 dark:text-gray-200">${a.name}</label>
                <div class="flex items-center gap-2">
                    <span class="text-sm text-gray-600 dark:text-gray-400">D√©pens√©: ${a.spent.toFixed(2)}‚Ç¨</span>
                    <input type="number" name="edit-${r}" value="${a.budget}" min="0" step="0.01" 
                           class="w-24 p-2 border border-gray-300 dark:border-gray-600 rounded text-center edit-category-input dark:bg-gray-800 dark:text-gray-200">
                    <span class="text-gray-600 dark:text-gray-400">‚Ç¨</span>
                    <button type="button" class="btn-edit-rest bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded text-sm transition-all hover:scale-105" data-category="${r}">
                        Reste ici
                    </button>
                    <button type="button" class="btn-delete-category bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-all hover:scale-105" data-category="${r}" title="Supprimer">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `,t.appendChild(s)}),t.querySelectorAll(".edit-category-input").forEach(r=>{r.addEventListener("input",()=>this.updateEditTotals())}),t.querySelectorAll(".btn-edit-rest").forEach(r=>{r.addEventListener("click",a=>{const s=a.target;this.allocateRemainingEditBudget(s.dataset.category)})}),t.querySelectorAll(".btn-delete-category").forEach(r=>{r.addEventListener("click",a=>{const s=a.target;this.deleteCategory(s.closest("button").dataset.category)})})}updateEditTotals(){const e=parseFloat(document.getElementById("edit-salary").value)||0,t=document.querySelectorAll(".edit-category-input");let r=0;t.forEach(a=>{r+=parseFloat(a.value)||0}),this.uiManager.updateEditTotals(e,r)}allocateRemainingEditBudget(e){const t=parseFloat(document.getElementById("edit-salary").value)||0;if(t===0){alert("Veuillez d'abord saisir votre salaire mensuel");return}const r=document.querySelectorAll(".edit-category-input");let a=0;r.forEach(n=>{n.name.replace("edit-","")!==e&&(a+=parseFloat(n.value)||0)});const s=t-a;if(s<0){alert("Le budget total d√©passe d√©j√† le salaire. R√©duisez d'abord les autres cat√©gories.");return}const i=document.querySelector(`input[name="edit-${e}"]`);if(i){i.value=s.toFixed(2),this.updateEditTotals();const n=this.dataManager.getData();this.uiManager.showNotification(`${s.toFixed(2)}‚Ç¨ allou√©s √† ${n.categories[e].name}`)}}saveEditedBudgets(){const e=parseFloat(document.getElementById("edit-salary").value),t=document.querySelectorAll(".edit-category-input");if(e<=0){alert("Veuillez saisir un salaire valide");return}let r=0;if(t.forEach(s=>{r+=parseFloat(s.value)||0}),r>e){alert("Le total des budgets d√©passe votre salaire. Veuillez ajuster les montants.");return}const a=this.dataManager.getData();a.salary=e,t.forEach(s=>{const i=s.name.replace("edit-",""),n=parseFloat(s.value)||0;a.categories[i]&&(a.categories[i].budget=n,a.categories[i].percentage=e>0?n/e*100:0)}),this.dataManager.saveData(),this.updateDashboard(),document.getElementById("edit-budget-modal").classList.add("hidden"),this.uiManager.showNotification("Budgets mis √† jour avec succ√®s !")}addNewCategory(){try{const e=document.getElementById("new-category-name").value.trim(),t=parseFloat(document.getElementById("new-category-budget").value),r=document.getElementById("new-category-color").value;this.categoryManager.addCategory(e,t,r),this.dataManager.saveData(),this.populateEditCategories(),this.updateEditTotals(),document.getElementById("new-category-modal").classList.add("hidden"),document.getElementById("new-category-form").reset(),this.uiManager.showNotification(`Cat√©gorie "${e}" cr√©√©e avec succ√®s ! üéâ`)}catch(e){this.uiManager.showNotification(e.message,"error")}}deleteCategory(e){try{const t=this.categoryManager.deleteCategory(e);let r=`Supprimer la cat√©gorie "${t.category.name}" ?`;if(t.transactionsCount>0&&(r+=`

‚ö†Ô∏è Attention : ${t.transactionsCount} transaction(s) seront √©galement supprim√©e(s).`),!confirm(r)){const a=this.dataManager.getData();a.categories[e]=t.category;return}this.dataManager.saveData(),this.populateEditCategories(),this.updateEditTotals(),this.uiManager.showNotification(`Cat√©gorie "${t.category.name}" supprim√©e`)}catch(t){this.uiManager.showNotification(t.message,"error")}}openTransactionsModal(e="all"){const t=this.dataManager.getData(),r=document.getElementById("category-filters");r.children.length===0&&Object.entries(t.categories).forEach(([a,s])=>{const i=document.createElement("button");i.className="filter-btn bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded-full text-sm transition-all duration-300 transform hover:scale-105",i.dataset.category=a,i.textContent=s.name,i.addEventListener("click",n=>{var d;const o=n.target;this.uiManager.updateButtonColors(o.dataset.category);const g=((d=document.getElementById("transaction-search"))==null?void 0:d.value)||"";this.filterTransactions(o.dataset.category,g)}),r.appendChild(i)}),this.uiManager.updateButtonColors(e),this.filterTransactions(e),document.getElementById("all-transactions-modal").classList.remove("hidden")}handleTransactionSearch(e){var a;const t=document.getElementById("clear-search");e.trim()===""?t.classList.add("hidden"):t.classList.remove("hidden");const r=((a=document.querySelector(".filter-btn.active"))==null?void 0:a.dataset.category)||"all";this.filterTransactions(r,e)}filterTransactions(e,t=""){const r=this.dataManager.getData(),a=document.getElementById("transactions-modal-title"),s=document.getElementById("category-stats"),i=document.getElementById("global-stats");if(e==="all"){a.textContent="Toutes les Transactions",s.classList.add("hidden");const d=this.transactionManager.getGlobalStats();document.getElementById("global-budget").textContent=`${d.budget.toFixed(2)}‚Ç¨`,document.getElementById("global-spent").textContent=`${d.spent.toFixed(2)}‚Ç¨`,document.getElementById("global-remaining").textContent=`${d.remaining.toFixed(2)}‚Ç¨`,document.getElementById("global-percentage").textContent=`${d.percentage.toFixed(1)}% utilis√©`;const c=document.getElementById("global-progress-bar"),h=Math.min(d.percentage,100);c.style.width=`${h}%`,d.percentage>100?c.className="h-full bg-gradient-to-r from-red-500 to-red-600 transition-all duration-700 ease-out relative shadow-sm":d.percentage>80?c.className="h-full bg-gradient-to-r from-yellow-500 to-orange-500 transition-all duration-700 ease-out relative shadow-sm":c.className="h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-700 ease-out relative shadow-sm",i.classList.remove("hidden")}else{const d=r.categories[e];a.textContent=`Transactions - ${d.name}`,i.classList.add("hidden");const c=this.transactionManager.getCategoryStats(e);if(c){document.getElementById("stats-budget").textContent=`${c.budget.toFixed(2)}‚Ç¨`,document.getElementById("stats-spent").textContent=`${c.spent.toFixed(2)}‚Ç¨`,document.getElementById("stats-remaining").textContent=`${c.remaining.toFixed(2)}‚Ç¨`,document.getElementById("stats-percentage").textContent=`${c.percentage.toFixed(1)}% utilis√©`;const h=document.getElementById("stats-progress-bar"),l=Math.min(c.percentage,100);h.style.width=`${l}%`,c.percentage>100?h.className="h-full bg-gradient-to-r from-red-500 to-red-600 transition-all duration-700 ease-out relative shadow-sm":c.percentage>80?h.className="h-full bg-gradient-to-r from-yellow-500 to-orange-500 transition-all duration-700 ease-out relative shadow-sm":h.className="h-full bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-700 ease-out relative shadow-sm"}s.classList.remove("hidden")}const n=this.transactionManager.filterTransactions(e,t),o=document.getElementById("all-transactions-list"),g=document.getElementById("no-transactions");n.length===0?(o.classList.add("hidden"),g.classList.remove("hidden")):(o.classList.remove("hidden"),g.classList.add("hidden"),o.innerHTML="",n.reverse().forEach(d=>{const c=new Date(d.date),h=r.categories[d.category];if(!h){console.warn(`‚ö†Ô∏è Transaction avec cat√©gorie inexistante: ${d.category}`);return}const l=document.createElement("div");l.className="bg-white p-4 rounded-lg shadow-md border-l-4 border-red-400 hover:shadow-lg transition-shadow",l.innerHTML=`
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex-1">
                            ${e==="all"?`
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-primary text-white px-2 py-1 rounded-full text-xs font-medium">${h.name}</span>
                                </div>
                            `:""}
                            <div class="font-semibold text-gray-800">${d.description||"Aucune description"}</div>
                            <div class="text-sm text-gray-600 mt-1">${c.toLocaleDateString("fr-FR")} √† ${c.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}</div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-right">
                                <div class="font-bold text-red-600 text-xl">-${d.amount.toFixed(2)}‚Ç¨</div>
                            </div>
                            <div class="flex flex-col gap-1">
                                <button class="edit-transaction-btn text-blue-600 hover:text-blue-800 text-sm p-2 rounded transition-colors" data-transaction-id="${d.id}" title="Modifier">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-transaction-btn text-red-600 hover:text-red-800 text-sm p-2 rounded transition-colors" data-transaction-id="${d.id}" title="Supprimer">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `,o.appendChild(l)}))}openEditTransactionModal(e){const t=this.transactionManager.getTransactionById(e);if(!t)return;document.getElementById("edit-transaction-category").value=t.category,document.getElementById("edit-transaction-amount").value=t.amount.toString(),document.getElementById("edit-transaction-description").value=t.description||"";const r=this.dataManager.getData(),a=document.getElementById("edit-transaction-category");a.innerHTML='<option value="">Choisir une cat√©gorie</option>',Object.entries(r.categories).forEach(([s,i])=>{const n=document.createElement("option");n.value=s,n.textContent=i.name,s===t.category&&(n.selected=!0),a.appendChild(n)}),this.editingTransactionId=e,document.getElementById("edit-transaction-modal").classList.remove("hidden")}saveEditedTransaction(){try{const e=this.editingTransactionId,t=document.getElementById("edit-transaction-category").value,r=parseFloat(document.getElementById("edit-transaction-amount").value),a=document.getElementById("edit-transaction-description").value;this.transactionManager.editTransaction(e,t,r,a),this.dataManager.saveData(),this.updateDashboard(),document.getElementById("edit-transaction-modal").classList.add("hidden"),this.editingTransactionId=null,this.uiManager.showNotification("Transaction modifi√©e avec succ√®s !"),this.checkAdvancedAlerts({changedCategory:t})}catch(e){this.uiManager.showNotification(e.message,"error")}}deleteTransaction(e){try{const t=this.transactionManager.getTransactionById(e);if(!t||!confirm(`√ätes-vous s√ªr de vouloir supprimer cette transaction ?

${t.description||"Aucune description"}
Montant: ${t.amount.toFixed(2)}‚Ç¨`))return;this.transactionManager.deleteTransaction(e),this.dataManager.saveData(),this.updateDashboard(),this.uiManager.showNotification("Transaction supprim√©e avec succ√®s !"),this.checkAdvancedAlerts()}catch(t){this.uiManager.showNotification(t.message,"error")}}addSavingsGoal(){try{const e=document.getElementById("goal-name").value,t=parseFloat(document.getElementById("goal-target").value),r=document.getElementById("goal-deadline").value,a=parseFloat(document.getElementById("goal-current").value)||0;this.savingsManager.addSavingsGoal(e,t,r,a),this.dataManager.saveData(),this.updateSavingsGoals(),document.getElementById("goal-modal").classList.add("hidden"),document.getElementById("goal-form").reset(),this.uiManager.showNotification(`Objectif "${e}" cr√©√© avec succ√®s ! üéØ`)}catch(e){this.uiManager.showNotification(e.message,"error")}}updateSavingsGoals(){const e=document.getElementById("savings-goals");if(!e)return;const t=this.savingsManager.getAllGoals();if(t.length===0){e.innerHTML=`
                <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                    <i class="fas fa-target text-4xl mb-4"></i>
                    <p>Aucun objectif d√©fini</p>
                    <p class="text-sm">Cr√©ez votre premier objectif d'√©pargne !</p>
                </div>
            `;return}e.innerHTML=t.map(r=>{const a=this.savingsManager.getGoalProgress(r.id);return a?`
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg transition-colors duration-300 ${a.isCompleted?"border-2 border-green-500":""}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2">
                                ${r.name}
                                ${a.isCompleted?'<i class="fas fa-trophy text-yellow-500"></i>':""}
                            </h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                ${r.current.toFixed(2)}‚Ç¨ / ${r.target.toFixed(2)}‚Ç¨
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm ${a.daysLeft>0?"text-gray-600 dark:text-gray-400":"text-red-500"}">
                                ${a.daysLeft>0?`${a.daysLeft} jours restants`:"√âch√©ance d√©pass√©e"}
                            </p>
                            <button class="text-red-500 hover:text-red-700 mt-1 delete-goal-btn" data-goal-id="${r.id}">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-600 dark:text-gray-400">Progression</span>
                            <span class="font-semibold ${a.isCompleted?"text-green-600":"text-gray-800 dark:text-gray-200"}">${a.progress.toFixed(1)}%</span>
                        </div>
                        <div class="w-full bg-gray-300 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-3 rounded-full transition-all duration-500 ${a.isCompleted?"bg-green-500":"bg-blue-500"}" 
                                 style="width: ${Math.min(a.progress,100)}%"></div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm transition-all duration-300 add-to-goal-btn" 
                                data-goal-id="${r.id}">
                            <i class="fas fa-plus mr-1"></i> Ajouter
                        </button>
                        <button class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-all duration-300 edit-goal-btn" 
                                data-goal-id="${r.id}">
                            <i class="fas fa-edit mr-1"></i> Modifier
                        </button>
                    </div>
                </div>
            `:""}).join(""),e.querySelectorAll(".delete-goal-btn").forEach(r=>{r.addEventListener("click",a=>{const s=a.currentTarget.dataset.goalId;this.deleteSavingsGoal(s)})}),e.querySelectorAll(".add-to-goal-btn").forEach(r=>{r.addEventListener("click",a=>{const s=a.currentTarget.dataset.goalId;this.addToGoal(s)})}),e.querySelectorAll(".edit-goal-btn").forEach(r=>{r.addEventListener("click",a=>{const s=a.currentTarget.dataset.goalId;this.editGoal(s)})})}addToGoal(e){const t=prompt("Montant √† ajouter √† l'objectif (‚Ç¨):");if(t)try{const r=this.savingsManager.addToGoal(e,parseFloat(t));this.dataManager.saveData(),this.updateSavingsGoals(),r.justCompleted&&this.uiManager.showNotification(`üéâ F√©licitations ! Objectif "${r.goal.name}" atteint !`)}catch(r){this.uiManager.showNotification(r.message,"error")}}deleteSavingsGoal(e){if(confirm("√ätes-vous s√ªr de vouloir supprimer cet objectif ?"))try{this.savingsManager.deleteSavingsGoal(e),this.dataManager.saveData(),this.updateSavingsGoals(),this.uiManager.showNotification("Objectif supprim√©")}catch(t){this.uiManager.showNotification(t.message,"error")}}editGoal(e){const t=this.savingsManager.getGoalById(e);if(!t)return;const r=prompt(`Modifier le montant √©pargn√© pour "${t.name}":`,t.current.toString());if(r!==null)try{const a=this.savingsManager.editGoal(e,r);this.dataManager.saveData(),this.updateSavingsGoals(),a.justCompleted&&this.uiManager.showNotification(`üéâ F√©licitations ! Objectif "${a.goal.name}" atteint !`)}catch(a){this.uiManager.showNotification(a.message,"error")}}openRecurringModal(){const e=this.dataManager.getData(),t=document.getElementById("recurring-category");t&&(t.innerHTML='<option value="">Choisir une cat√©gorie</option>',Object.entries(e.categories).forEach(([r,a])=>{const s=document.createElement("option");s.value=r,s.textContent=a.name,t.appendChild(s)})),document.getElementById("recurring-modal").classList.remove("hidden")}addRecurringTransaction(){try{const e=document.getElementById("recurring-name").value,t=document.getElementById("recurring-category").value,r=parseFloat(document.getElementById("recurring-amount").value),a=document.getElementById("recurring-frequency").value,s=parseInt(document.getElementById("recurring-day").value),i=document.getElementById("recurring-active").checked;this.recurringManager.addRecurringTransaction(e,t,r,a,s,i),this.dataManager.saveData(),this.updateRecurringTransactions(),document.getElementById("recurring-modal").classList.add("hidden"),document.getElementById("recurring-form").reset(),this.uiManager.showNotification(`Transaction r√©currente "${e}" cr√©√©e !`)}catch(e){this.uiManager.showNotification(e.message,"error")}}updateRecurringTransactions(){const e=document.getElementById("recurring-transactions");if(!e)return;const t=this.recurringManager.getAllRecurringTransactions();if(t.length===0){e.innerHTML=`
                <div class="text-center text-gray-500 dark:text-gray-400 py-4">
                    <i class="fas fa-calendar-check text-3xl mb-2"></i>
                    <p class="text-sm">Aucune transaction r√©currente</p>
                </div>
            `;return}const r=this.dataManager.getData();e.innerHTML=t.map(a=>{const s=r.categories[a.category];return`
                <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg flex justify-between items-center">
                    <div>
                        <p class="font-semibold text-gray-800 dark:text-gray-200">${a.name}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">${(s==null?void 0:s.name)||a.category} ‚Ä¢ ${a.amount.toFixed(2)}‚Ç¨ ‚Ä¢ ${a.frequency}</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="text-${a.active?"green":"gray"}-600 hover:text-${a.active?"green":"gray"}-800 toggle-recurring-btn" data-recurring-id="${a.id}">
                            <i class="fas fa-${a.active?"check-circle":"pause-circle"}"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-800 delete-recurring-btn" data-recurring-id="${a.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `}).join(""),e.querySelectorAll(".toggle-recurring-btn").forEach(a=>{a.addEventListener("click",s=>{const i=s.currentTarget.dataset.recurringId;this.toggleRecurring(i)})}),e.querySelectorAll(".delete-recurring-btn").forEach(a=>{a.addEventListener("click",s=>{const i=s.currentTarget.dataset.recurringId;this.deleteRecurring(i)})})}toggleRecurring(e){try{this.recurringManager.toggleRecurringTransaction(e),this.dataManager.saveData(),this.updateRecurringTransactions()}catch(t){this.uiManager.showNotification(t.message,"error")}}deleteRecurring(e){if(confirm("Supprimer cette transaction r√©currente ?"))try{this.recurringManager.deleteRecurringTransaction(e),this.dataManager.saveData(),this.updateRecurringTransactions(),this.uiManager.showNotification("Transaction r√©currente supprim√©e")}catch(t){this.uiManager.showNotification(t.message,"error")}}getBudgetTemplates(){return{etudiant:{name:"üéì √âtudiant",description:"Budget adapt√© pour un √©tudiant",salary:800,categories:{logement:{name:"Logement",budget:400,color:"#3b82f6",spent:0},courses:{name:"Courses",budget:150,color:"#10b981",spent:0},transport:{name:"Transport",budget:50,color:"#f59e0b",spent:0},loisirs:{name:"Loisirs",budget:100,color:"#8b5cf6",spent:0},telephone:{name:"T√©l√©phone",budget:20,color:"#ec4899",spent:0},divers:{name:"Divers",budget:80,color:"#6b7280",spent:0}}},celibataire:{name:"üë§ C√©libataire",description:"Budget pour une personne seule",salary:2e3,categories:{logement:{name:"Logement",budget:700,color:"#3b82f6",spent:0},courses:{name:"Courses",budget:300,color:"#10b981",spent:0},transport:{name:"Transport",budget:150,color:"#f59e0b",spent:0},loisirs:{name:"Loisirs",budget:200,color:"#8b5cf6",spent:0},sante:{name:"Sant√©",budget:100,color:"#ef4444",spent:0},epargne:{name:"√âpargne",budget:300,color:"#14b8a6",spent:0},divers:{name:"Divers",budget:250,color:"#6b7280",spent:0}}},couple:{name:"üíë Couple",description:"Budget pour un couple sans enfants",salary:3500,categories:{logement:{name:"Logement",budget:1e3,color:"#3b82f6",spent:0},courses:{name:"Courses",budget:500,color:"#10b981",spent:0},transport:{name:"Transport",budget:300,color:"#f59e0b",spent:0},loisirs:{name:"Loisirs",budget:400,color:"#8b5cf6",spent:0},restaurants:{name:"Restaurants",budget:250,color:"#f97316",spent:0},sante:{name:"Sant√©",budget:150,color:"#ef4444",spent:0},epargne:{name:"√âpargne",budget:600,color:"#14b8a6",spent:0},divers:{name:"Divers",budget:300,color:"#6b7280",spent:0}}},famille:{name:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Famille",description:"Budget pour une famille avec enfants",salary:4500,categories:{logement:{name:"Logement",budget:1200,color:"#3b82f6",spent:0},courses:{name:"Courses",budget:700,color:"#10b981",spent:0},transport:{name:"Transport",budget:400,color:"#f59e0b",spent:0},enfants:{name:"Enfants",budget:500,color:"#ec4899",spent:0},loisirs:{name:"Loisirs",budget:300,color:"#8b5cf6",spent:0},sante:{name:"Sant√©",budget:200,color:"#ef4444",spent:0},education:{name:"√âducation",budget:300,color:"#06b6d4",spent:0},epargne:{name:"√âpargne",budget:500,color:"#14b8a6",spent:0},divers:{name:"Divers",budget:400,color:"#6b7280",spent:0}}},retraite:{name:"üèñÔ∏è Retrait√©",description:"Budget adapt√© pour un retrait√©",salary:1800,categories:{logement:{name:"Logement",budget:600,color:"#3b82f6",spent:0},courses:{name:"Courses",budget:350,color:"#10b981",spent:0},sante:{name:"Sant√©",budget:250,color:"#ef4444",spent:0},loisirs:{name:"Loisirs",budget:200,color:"#8b5cf6",spent:0},transport:{name:"Transport",budget:100,color:"#f59e0b",spent:0},famille:{name:"Famille",budget:150,color:"#ec4899",spent:0},divers:{name:"Divers",budget:150,color:"#6b7280",spent:0}}}}}showTemplateModal(){const e=document.getElementById("template-modal"),t=document.getElementById("templates-list"),r=this.getBudgetTemplates();t.innerHTML=Object.entries(r).map(([a,s])=>`
            <div class="p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary dark:hover:border-blue-400 transition-all duration-300 cursor-pointer template-item" data-template="${a}">
                <div class="text-3xl mb-2">${s.name.split(" ")[0]}</div>
                <h4 class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-2">${s.name.split(" ").slice(1).join(" ")}</h4>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">${s.description}</p>
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Revenu:</span>
                    <span class="font-bold text-primary dark:text-blue-400">${s.salary}‚Ç¨</span>
                </div>
                <div class="flex items-center justify-between text-sm mt-1">
                    <span class="text-gray-600 dark:text-gray-400">Cat√©gories:</span>
                    <span class="font-bold text-gray-700 dark:text-gray-300">${Object.keys(s.categories).length}</span>
                </div>
            </div>
        `).join(""),t.querySelectorAll(".template-item").forEach(a=>{a.addEventListener("click",()=>{const s=a.dataset.template;this.loadTemplate(s)})}),e.classList.remove("hidden")}loadTemplate(e){const r=this.getBudgetTemplates()[e];if(!r){this.uiManager.showNotification("Template introuvable","error");return}if(!confirm(`Charger le template "${r.name}" ?

Cela remplacera votre configuration actuelle (vos transactions seront conserv√©es).`))return;const a=this.dataManager.getData();a.salary=r.salary,a.categories=JSON.parse(JSON.stringify(r.categories)),Object.keys(a.categories).forEach(s=>{a.categories[s].spent=0}),a.transactions.forEach(s=>{a.categories[s.category]&&(a.categories[s.category].spent+=s.amount)}),this.dataManager.saveData(),this.updateDashboard(),document.getElementById("template-modal").classList.add("hidden"),this.uiManager.showNotification(`Template "${r.name}" charg√© avec succ√®s ! üéâ`)}updateTopExpenses(){const e=document.getElementById("top-expenses");if(!e)return;const t=this.transactionManager.getTopExpenses(5);if(t.length===0){e.innerHTML=`
                <div class="text-center text-gray-500 dark:text-gray-400 py-4">
                    <i class="fas fa-chart-bar text-3xl mb-2"></i>
                    <p class="text-sm">Aucune d√©pense enregistr√©e</p>
                </div>
            `;return}const r=this.dataManager.getData();e.innerHTML=t.map((a,s)=>{const i=["ü•á","ü•à","ü•â","4Ô∏è‚É£","5Ô∏è‚É£"][s],n=r.categories[a.category];return`
                <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${i}</span>
                        <div>
                            <p class="font-semibold text-gray-800 dark:text-gray-200">${a.description||"Sans description"}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${(n==null?void 0:n.name)||a.category}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-red-600">${a.amount.toFixed(2)}‚Ç¨</p>
                    </div>
                </div>
            `}).join("")}openColorThemeModal(){const e=document.getElementById("color-theme-modal");if(e){e.classList.remove("hidden");const t=this.themeManager.getColorTheme();document.querySelectorAll(".color-theme-option").forEach(r=>{r.dataset.theme===t?r.classList.add("ring-4","ring-offset-2","ring-primary"):r.classList.remove("ring-4","ring-offset-2","ring-primary")})}}closeColorThemeModal(){const e=document.getElementById("color-theme-modal");e&&e.classList.add("hidden")}renderWidgetCalendar(){const e=document.getElementById("widget-calendar-month-title"),t=document.getElementById("widget-calendar-grid"),r=document.getElementById("widget-monthly-projection");if(!e||!t||!r)return;e.textContent=this.calendarManager.getMonthName();const a=this.calendarManager.getMonthlyProjection();r.textContent=`${a.toFixed(2)}‚Ç¨`;const s=this.calendarManager.getMonthDays(),i=this.dataManager.getData();t.innerHTML=s.map(n=>{const o=n.date.getDate(),g=n.transactions.length>0,d=n.recurringTransactions.length>0;let c="bg-white dark:bg-gray-700",h="text-gray-800 dark:text-gray-200",l="";n.isCurrentMonth||(c="bg-gray-100 dark:bg-gray-800",h="text-gray-400 dark:text-gray-600"),n.isToday&&(l="ring-2 ring-primary");let m="";g&&(m+='<div class="w-2 h-2 bg-blue-500 rounded-full"></div>'),d&&(m+='<div class="w-2 h-2 bg-orange-500 rounded-full"></div>');let v="";if(g||d){const f=n.transactions.map(b=>{const E=i.categories[b.category];return`${(E==null?void 0:E.name)||b.category}: ${b.amount}‚Ç¨`}).join(", "),y=n.recurringTransactions.map(b=>`${b.name}: ${b.amount}‚Ç¨ (pr√©vu)`).join(", ");v=`title="${f}${f&&y?" | ":""}${y}"`}return`
                <div class="calendar-day ${c} ${l} p-2 rounded-lg min-h-[80px] cursor-pointer hover:shadow-md transition-shadow" ${v}>
                    <div class="${h} font-semibold text-sm mb-1">${o}</div>
                    <div class="flex flex-wrap gap-1">
                        ${m}
                    </div>
                    ${g||d?`
                        <div class="text-xs ${h} mt-1">
                            ${n.transactions.reduce((f,y)=>f+y.amount,0)+n.recurringTransactions.reduce((f,y)=>f+y.amount,0)}‚Ç¨
                        </div>
                    `:""}
                </div>
            `}).join("")}async handlePullToRefresh(){console.log("üîÑ Pull to refresh..."),this.uiManager.showNotification("üîÑ Actualisation...","info");try{await this.dataManager.loadData(),this.updateDashboard(),this.uiManager.showNotification("‚úÖ Donn√©es actualis√©es","success")}catch{this.uiManager.showNotification("‚ùå Erreur lors de l'actualisation","error")}}}document.addEventListener("DOMContentLoaded",()=>{const p=new G;window.budgetManager=p});
//# sourceMappingURL=index-DLk6_KXT.js.map
